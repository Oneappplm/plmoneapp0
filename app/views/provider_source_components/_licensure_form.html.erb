<div class="licensure-field" id="fields">
<div class="row mb-3">
   <div class="col-lg-12">
      <%= HtmlUtils::dropdown name: 'licensure_state', label: 'Licensure State' %>
   </div>
</div>
<div class="row mb-3">
   <div class="col-lg-12">
    <label class="text-dark-grey">License Type <span class="text-danger">*</span></label>
    <select name="license_type" required class="form-select border-dark">
      <option value="" disabled selected>Select License Type</option>
      <option value="licensed_medical_esthetician">Licensed Medical Esthetician</option>
      <option value="medical_assistant">Medical Assistant</option>
      <option value="medical_doctor">Medical Doctor (MD)</option>
      <option value="registered_medical_assistant">Registered Medical Assistant</option>
    </select>
  </div>
</div>
<div class="row mb-3">
    <div class="col-lg-6">
      <label class="text-dark-grey">License Number <span class="text-danger">*</span></label>
      <input 
        type="text" 
        name="license_number" 
        id="license-number-input" 
        required 
        class="form-control border-dark" 
        placeholder="License Number"
        oninput="validateLicenseNumber()"
      >
      <small id="license-number-error" class="text-danger d-none">Only numbers are allowed.</small>
    </div>
    <div class="col-lg-6">
      <label class="text-dark-grey">License Status <span class="text-danger">*</span></label>
      <input 
        type="text" 
        name="license_status" 
        id="license-status-input"
        required 
        class="form-control border-dark"
        oninput="validateLicenseStatus()"
      >
      <small id="license-status-error" class="text-danger d-none">Numbers are not allowed.</small>
    </div>
</div>
<div class="row mb-3">
  <div class="col-lg-6">
    <label class="text-dark-grey">Issue Date <span class="text-danger">*</span></label>
    <input type="date" name="licensure_issue_date" id="issue-date" required class="form-control border-dark">
  </div>

  <div class="col-lg-6">
    <label class="text-dark-grey">Expiration Date <span class="text-danger">*</span></label>
    <input type="date" name="licensure_expiration_date" id="expire-date" required class="form-control border-dark licensure-expire" disabled>

    <span class="d-flex gap-2 mt-1">
      <input type="checkbox" name="licensure_not_expire" id="licensure-not-expire">
      <small>Does not expire</small>
    </span>
  </div>
</div>
<div class="row mb-3">
   <div class="col-lg-12">
      <div class="d-flex justify-content-between my-3">
         <label class="form-label">Are you currently practicing in this state? <span class="text-danger">*</span></label>
         <div class="d-flex me-4 gap-2">
            <span>
            <input type="radio" value="yes" name="licensure_practice_state" required>
            <span>YES</span>
            </span>
            <span>
            <input type="radio" value="no" name="licensure_practice_state" required>
            <span>NO</span>
            </span>
         </div>
      </div>
   </div>
</div>
<div class="row mb-3">
   <div class="col-lg-12">
      <div class="d-flex justify-content-between my-3">
         <label class="form-label">Is this your primary license? <span class="text-danger">*</span></label>
         <div class="d-flex me-4 gap-2">
            <span>
            <input type="radio" value="yes" name="licensure_primary_license" required>
            <span>YES</span>
            </span>
            <span>
            <input type="radio" value="no" name="licensure_primary_license" required>
            <span>NO</span>
            </span>
         </div>
      </div>
   </div>
</div>
<div class="row mb-3">
   <div class="col-lg-12">
      <div class="d-flex justify-content-between my-3">
         <label class="form-label">Does this license require supervision? <span class="text-danger">*</span></label>
         <div class="d-flex me-4 gap-2">
            <span>
            <input type="radio" value="yes" name="licensure_require_supervision" required>
            <span>YES</span>
            </span>
            <span>
            <input type="radio" value="no" name="licensure_require_supervision" required>
            <span>NO</span>
            </span>
         </div>
      </div>
   </div>
</div>
<div class="row mt-3 d-none" id="supervised_fields">
   <div class="col-lg-12">
      <h5>Name of Sponsor</h5>
   </div>
   <div class="col-lg-4">
      <label class="text-dark-grey">First Name</label>
      <input type="text" name="licensure_sponsor_fname" class="form-control border-dark">
   </div>
   <div class="col-lg-2">
      <label class="text-dark-grey">Middle Name</label>
      <input type="text" name="licensure_sponsor_mname" class="form-control border-dark">
   </div>
   <div class="col-lg-4">
      <label class="text-dark-grey">Last Name</label>
      <input type="text" name="licensure_sponsor_lname" class="form-control border-dark">
   </div>
   <div class="col-lg-2">
      <label class="text-dark-grey">Suffix</label>
      <select class="form-select border-dark" placeholder="Suffix" name="licensure_sponsor_suffix">
         <option>Suffix</option>
         <option>Jr.</option>
         <option>Sr.</option>
         <option>III.</option>
         <option>IV.</option>
      </select>
   </div>
    <div class="col-lg-12 mt-3">
      <label class="text-dark-grey">Degree</label>
      <input 
        type="text" 
        name="licensure_sponsor_degree" 
        id="degree-input"
        class="form-control border-dark" 
        oninput="validateDegreeInput()"
      >
      <small id="degree-error" class="text-danger d-none">Numbers are not allowed.</small>
    </div>
</div>
</div>
<script>
	$('input[name=licensure_require_supervision]').on('change',function(){
		$(this).val() == 'yes' ? $('#supervised_fields').removeClass('d-none') : $('#supervised_fields').addClass('d-none');
	})

   $('#licensure-not-expire').on('change',function(){
    console.log($(this).prop('checked'));
    if($(this).prop('checked'))
    {
      $('.licensure-expire').prop('disabled', true);
      $('.licensure-expire').val('');
    }
    else
      $('.licensure-expire').removeAttr('disabled');

   });
  document.addEventListener("DOMContentLoaded", () => {
    const issueDateInput = document.getElementById("issue-date");
    const expireDateInput = document.getElementById("expire-date");
    const notExpireCheckbox = document.getElementById("licensure-not-expire");

    issueDateInput.addEventListener("change", () => {
      const issueDateValue = issueDateInput.value;
      if (issueDateValue) {
        const issueDate = new Date(issueDateValue);
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        // Use the later of today or issue date
        const minExpireDate = issueDate > today ? issueDate : today;
        const minDateStr = minExpireDate.toISOString().split('T')[0];

        expireDateInput.disabled = false;
        expireDateInput.min = minDateStr;

        if (expireDateInput.value && new Date(expireDateInput.value) < minExpireDate) {
          alert(`Expiration date must be after ${minDateStr}`);
          expireDateInput.value = '';
        }
      } else {
        expireDateInput.disabled = true;
        expireDateInput.value = '';
        expireDateInput.removeAttribute("min");
      }
    });

    expireDateInput.addEventListener("focus", () => {
      if (expireDateInput.disabled) {
        alert("Please select Issue Date first.");
        expireDateInput.blur();
      }
    });

    notExpireCheckbox.addEventListener("change", () => {
      if (notExpireCheckbox.checked) {
        expireDateInput.disabled = true;
        expireDateInput.required = false;
        expireDateInput.value = '';
      } else {
        if (issueDateInput.value) {
          expireDateInput.disabled = false;
          expireDateInput.required = true;
        }
      }
    });
  });
  function validateDegreeInput() {
    const input = document.getElementById("degree-input");
    const error = document.getElementById("degree-error");

    if (/\d/.test(input.value)) {
      error.classList.remove("d-none");
      input.value = input.value.replace(/\d/g, '');
    } else {
      error.classList.add("d-none");
    }
  }
  function validateLicenseStatus() {
    const input = document.getElementById("license-status-input");
    const error = document.getElementById("license-status-error");

    if (/\d/.test(input.value)) {
      error.classList.remove("d-none");
      input.value = input.value.replace(/\d/g, '');
    } else {
      error.classList.add("d-none");
    }
  }
  function validateLicenseNumber() {
    const input = document.getElementById("license-number-input");
    const error = document.getElementById("license-number-error");

    if (/[^0-9]/.test(input.value)) {
      error.classList.remove("d-none");
      input.value = input.value.replace(/[^0-9]/g, '');
    } else {
      error.classList.add("d-none");
    }
  }
</script>
