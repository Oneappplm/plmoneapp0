<div class="row my-3 px-3">
  <div class="col-lg-12">
    <!-- start of table header -->
    <div class="row mt-5 mb-3">
      <div class="col-lg-12">
        <table class="table table--default table-borderless" id="documents-table">
          <thead class="bg-primary">
            <tr class="rounded">
              <th class="text-white">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" onclick="checkAll();" id="checkAllCbs">
                </div>
              </th>
              <th class="text-white">
                <span>Document Name</span>
              </th>
              <th class="text-white">
                Upload Date
              </th>
              <th class="text-white">
                File Size
              </th>
              <th class="text-white">
                Document Type
              </th>
              <th class="text-white">
                Actions
              </th>
            </tr>
          </thead>
          <tbody>
            <% @provider_source_documents.each do |document| %>
              <tr>
                <td>
                  <div class="form-check">
                    <input class="form-check-input user-cbs" type="checkbox" value="<%= document.id %>" id="flexCheckDefault" name="document_ids[]">
                  </div>
                </td>
                <td><%= document.file_name %></td>
                <td><%= document.created_at.strftime("%m/%d/%Y") %></td>
                <td><%= number_to_human_size(document.file_path.size) %></td>
                <td><%= File.extname(document.file_name).delete(".") %></td>
                <td>
								<div class="d-flex">
                  <a href="javascript:void(0);" data-document-id="<%= document.id %>" data-bs-toggle="modal" data-bs-target="#exampleModal">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="svg-icon text-primary">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                    </svg>
                  </a>
									
									<a href="javascript:void(0);" class="delete-document" data-id="<%= document.id %>" data-confirm="Are you sure you want to delete this document?">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="svg-icon text-danger">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                    </svg>
                  </a>

								</div>
								<button id="backToTopBtn" class="btn-back-to-top"><i class="fa-solid fa-arrow-up"></i></button>
							</td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
    <!-- end of table header -->
  </div>
</div>


<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Document</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <%= form_with(url: edit_document_provider_sources_path, method: :post, multipart: true) do |form| %>
          <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
          <%= form.hidden_field :document_id, value: '' %> <!-- This will be set dynamically via JavaScript -->
          <div class="form-group">
            <label for="documentFile">Select New Document</label>
            <%= form.file_field :document_file, class: "form-control", required: true %>
          </div>
          <button type="submit" class="btn btn-primary mt-3">Upload</button>
        <% end %>
      </div>
    </div>
  </div>
</div>



<script>
  <%# for edit the uploaded document %>
   document.addEventListener('DOMContentLoaded', function() {
    var exampleModal = document.getElementById('exampleModal');
    exampleModal.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget; // Button that triggered the modal
      var documentId = button.getAttribute('data-document-id'); // Extract info from data-* attributes

      // Update the hidden field in the form with the document ID
      var form = exampleModal.querySelector('form');
      form.querySelector('[name="document_id"]').value = documentId;
    });
  });

   <%# for deleting the document %>
   $(document).ready(function() {
    $('.delete-document').on('click', function(e) {
      e.preventDefault();

      var documentId = $(this).data('id');
      var confirmMessage = $(this).data('confirm');
      var row = $(this).closest('tr');

      if (confirm(confirmMessage)) {
        $.ajax({
          url: '/provider_sources/delete_document',
          type: 'POST',
          data: JSON.stringify({ document_id: documentId }),
          contentType: 'application/json',
          headers: {
            'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
          },
          success: function(data) {
            if (data.success) {
              row.remove();
              // Reload the page to show the flash message
              location.reload();
            } else {
              alert('Failed to delete the document.');
            }
          },
          error: function() {
            alert('An error occurred. Please try again.');
          }
        });
      }
    });
  });


  function checkAll() {
	  const checkboxes = document.querySelectorAll('.user-cbs');
	  const checkAllBox = document.getElementById('checkAllCbs');
	  checkboxes.forEach((checkbox) => {
	    checkbox.checked = checkAllBox.checked;
	  });
	  updateSelectedDocumentIds();
	}

	document.querySelectorAll('.user-cbs').forEach((checkbox) => {
	  checkbox.addEventListener('change', updateSelectedDocumentIds);
	});

	function updateSelectedDocumentIds() {
	  const selectedIds = [];
	  document.querySelectorAll('.user-cbs:checked').forEach((checkbox) => {
	    selectedIds.push(checkbox.value);
	  });
	  document.getElementById('document-ids').value = selectedIds.join(',');
	}


</script>
<style>
  .form-check-input {
    width: 18px;
    height: 18px;
    background-color: #000; /* Default background */
    border: 2px solid #333; /* Dark border */
    border-radius: 4px; /* Slightly rounded corners */
    appearance: none; /* Removes default browser styling */
    cursor: pointer;
    position: relative;
    outline: none;
  }

  .form-check-input:checked {
    background-color: #000; /* Black background when checked */
    border-color: #000;
    box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
  }

  .form-check-input:checked::before {
    content: 'âœ”'; /* Add a checkmark */
    color: #fff;
    font-weight: bold;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 12px;
  }

  .form-check-input:hover {
    border-color: #555; /* Slightly lighter border on hover */
    box-shadow: 0 0 4px rgba(0, 0, 0, 0.3);
  }

  .form-check-label {
    margin-left: 8px;
    color: #000;
    font-weight: 500;
    cursor: pointer;
  }

  /* Optional: Adjust alignment */
  .form-check {
    display: flex;
    align-items: center;
    gap: 10px;
  }
</style>
