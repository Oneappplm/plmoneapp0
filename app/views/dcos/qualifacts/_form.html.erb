<%
	form_path = if is_edit_mode?
			group_dco_path(@enrollment_group, @dco)
		else
			group_dcos_path(@enrollment_group, @dco)
		end
%>
<%= form_for @dco, :url => form_path, html: { multipart: true, id: 'dco-form' } do |f| %>
	<% if @dco.errors.any? %>
    <div id="error_explanation" class="row mb-3">
			<div class="col-lg-12">
				<h2><%= pluralize(@dco.errors.count, "error") %> prohibited this enrollment user from being saved:</h2>
				<ul>
					<% @dco.errors.full_messages.each do |message| %>
						<li><%= message %></li>
					<% end %>
				</ul>
			</div>
    </div>
  <% end %>
	<div class="row mb-3">
    <div class="col-lg-12">
      <h5 class="mb-0">Practitioner Personal Information</h5>
      <small class="text-black">Please fill out all required fields. Optional field are marked as (optional)</small>
    </div>
	</div>
	<div class="row mb-3">
		<div class="col-lg-6">
      <label class="text-dark-grey">Practice Location Name</label>
			<%= f.text_field :dco_name, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
		<div class="col-lg-6">
      <label class="text-dark-grey">Address</label>
			<%= f.text_field :dco_address, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
	</div>
	<div class="row mb-3">
		<div class="col-lg-6">
      <label class="text-dark-grey">City</label>
			<%= f.text_field :dco_city, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
		<div class="col-lg-6">
      <label class="text-dark-grey">State</label>
			<%= f.collection_select :state, @states, :name, :name, { prompt: 'Select option' }, { class: 'form-control', required: true } %>
		</div>
	</div>
	<div class="row mb-3">
		<div class="col-lg-6">
      <label class="text-dark-grey">County</label>
			<%= f.text_field :county, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
		<div class="col-lg-6">
      <label class="text-dark-grey">Zip Code</label>
			<%= f.text_field :dco_zipcode, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
	</div>
	<div class="row mb-3">
		<div class="col-lg-6">
      <label class="text-dark-grey">Service Location Phone Number</label>
			<%= f.text_field :service_location_phone_number, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
		<div class="col-lg-6">
      <label class="text-dark-grey">Service Location Fax Number</label>
			<%= f.text_field :service_location_fax_number, class: 'form-control', placeholder: 'Type here...', required: true%>
		</div>
	</div>
	<div class="row mb-3">
		<div class="col-lg-6">
      <label class="text-dark-grey">Panel Status to New Patients</label>
			<%= f.text_field :panel_status_to_new_patients, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
		<div class="col-lg-6">
      <label class="text-dark-grey">Panel Age Limit</label>
			<%= f.text_field :panel_age_limit, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
	</div>
	<div class="row mb-3">
		<div class="col-lg-6">
      <label class="text-dark-grey">Include in Directory?</label>
			<%= f.select :include_in_directory, options_for_select(yes_or_no_options, f.object.include_in_directory), { prompt: 'Select option' }, { class: 'form-select', required: true } %>
		</div>
	</div>
	<div class="row my-4">
    <div class="col-lg-12">
      <h5 class="mb-0">Old Practice Location Address</h5>
    </div>
	</div>
	<div class="row mb-3">
		<div class="col-lg-6">
      <label class="text-dark-grey">Address</label>
			<%= f.text_field :old_address, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
		<div class="col-lg-6">
      <label class="text-dark-grey">City</label>
			<%= f.text_field :old_city, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
	</div>
	<div class="row mb-3">
		<div class="col-lg-6">
      <label class="text-dark-grey">State</label>
			<%= f.collection_select :old_state, @states, :name, :name, { prompt: 'Select option' }, { class: 'form-control', required: true } %>
		</div>
		<div class="col-lg-6">
      <label class="text-dark-grey">County</label>
				<%= f.text_field :old_county, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
	</div>
	<div class="row mb-3">
		<label class="text-dark-grey">Zip Code</label>
    <div class="col-lg-6 mb-lg-0 mb-2">
			<%= f.text_field :old_zipcode, class: 'form-control', placeholder: 'Type here...', required: true %>
    </div>
    <div class="col-lg-6 d-flex justify-content-lg-start justify-content-center align-items-center">
      <label class="text-dark-grey"></label>
      <%= f.check_box :is_old_location_primary %>
      <%= f.label :is_old_location_primary, "Set as primary", class: 'mx-2 text-dark-grey' %>
    </div>
  </div>

	<div class="row field mb-3 p-2 border border-2">
		<%= render partial: "global_components/collapsible_sidebar_header", locals: { title: 'Schedules', collapse_name: 'schedules', text_position: 'text-start'}%>
		<div class="collapsible" style="<%= current_user&.is_card_open?('schedules') ? '' : 'display: none;' %>">
			<div id="schedules">
				<div class="fields field mb-3">
					<%= f.fields_for :schedules do |schedule_fields| %>
						<%= render 'dcos/qualifacts/schedule_fields', f: schedule_fields %>
					<% end %>
				</div>
				<div class="links mt-2 text-center">
					<button type="button" class="add_association btn btn-xs btn-primary m-auto">Add Schedule</button>
				</div>
			</div>
		</div>
	</div>

	<div class="row field mb-3 p-2 border border-2">
		<%= render partial: "global_components/collapsible_sidebar_header", locals: { title: 'Service Contact List', collapse_name: 'service_contacts_list', text_position: 'text-start'}%>
		<div class="collapsible" style="<%= current_user&.is_card_open?('service_contacts_list') ? '' : 'display: none;' %>">
			<div id="dco-provider-outreach-info">
					<div class="fields field mb-3">
						<%= f.fields_for :provider_outreach_info do |provider_outreach_info_fields| %>
							<%= render 'dcos/qualifacts/provider_outreach_info', f: provider_outreach_info_fields %>
						<% end %>
					</div>
					<div class="links mt-2 text-center">
						<button type="button" class="add_association btn btn-xs btn-primary m-auto">Add New</button>
					</div>
			</div>
		</div>
	</div>

  <div class="row mb-3">
    <div class="col-lg-6">
      <label class="text-dark-grey">Is this location inpatient facility?</label>
      <%= f.select :inpatient_facility, options_for_select(yes_or_no_options, f.object.inpatient_facility), { prompt: 'Select option' }, { class: 'form-select', required: true } %>
    </div>
    <div class="col-lg-6">
      <label class="text-dark-grey">Is this location a clinic?</label>
      <%= f.select :is_clinic, options_for_select(yes_or_no_options, f.object.is_clinic), { prompt: 'Select option' }, { class: 'form-select', required: true } %>
    </div>
  </div>
	<div class="row mb-3">
    <div class="col-lg-6">
      <label class="text-dark-grey">Are you a Telehealth service provider?</label>
      <%= f.select :telehealth_provider, options_for_select(yes_or_no_options, f.object.inpatient_facility), { prompt: 'Select option' }, { class: 'form-select', required: true } %>
    </div>
    <div class="col-lg-6">
      <label class="text-dark-grey">Website</label>
			<%= f.text_field :website, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
  </div>
	<div class="row mb-3">
    <div class="col-lg-6">
      <label class="text-dark-grey">Tax ID</label>
			<%= f.text_field :tax_id, class: 'form-control', placeholder: 'Type here...', required: true %>
    </div>
    <div class="col-lg-6">
      <label class="text-dark-grey">Facility Billing NPI (Institutional)</label>
			<%= f.text_field :facility_billing_npi, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
  </div>
	<div class="row mb-3">
    <div class="col-lg-6">
      <label class="text-dark-grey">MN Medicaid Number</label>
      <%= f.text_field :mn_medicaid_number, class: 'form-control', placeholder: 'Type here...', required: true %>
    </div>
    <div class="col-lg-6">
      <label class="text-dark-grey">WI Medicaid Number</label>
			<%= f.text_field :wi_medicaid_number, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
  </div>
	<div class="row mb-3">
    <div class="col-lg-6">
      <label class="text-dark-grey">Medicare ID PTAN</label>
      <%= f.text_field :medicare_id_ptan, class: 'form-control', placeholder: 'Type here...', required: true %>
    </div>
    <div class="col-lg-6">
      <label class="text-dark-grey">Taxonomy</label>
			<%= f.text_field :taxonomy, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
  </div>
	<div class="row mb-3">
    <div class="col-lg-6">
      <label class="text-dark-grey">Telehealth video conferencing technology used</label>
      <%= f.text_field :telehealth_video_conferencing_technology, class: 'form-control', placeholder: 'Type here...', required: true %>
    </div>
    <div class="col-lg-6">
      <label class="text-dark-grey">Does the provider offer Gender Affirming Treatment</label>
			<%= f.select :is_gender_affirming_treatment, options_for_select(yes_or_no_options, f.object.is_clinic), { prompt: 'Select option' }, { class: 'form-select', required: true } %>
		</div>
  </div>
	<div class="row mb-3">
    <div class="col-lg-6">
      <label class="text-dark-grey">Panel Size</label>
      <%= f.text_field :panel_size, class: 'form-control', placeholder: 'Type here...', required: true %>
    </div>
    <div class="col-lg-6">
      <label class="text-dark-grey">Medicare Authorized Official</label>
			<%= f.text_field :medicare_authorized_official, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
  </div>

	<div class="row field mb-3 p-2 border border-2">
		<%= render partial: "global_components/collapsible_sidebar_header", locals: { title: 'Qualifacts Contact List', collapse_name: 'contacts_list', text_position: 'text-start'}%>
		<div class="collapsible" style="<%= current_user&.is_card_open?('contacts_list') ? '' : 'display: none;' %>">
			<div id="group-dco-contacts">
				<div class="fields field mb-3">
					<%= f.fields_for :group_dco_contacts do |group_dco_contact_fields| %>
						<%= render 'dcos/qualifacts/contact_list', f: group_dco_contact_fields %>
					<% end %>
				</div>
				<div class="links mt-2 text-center">
					<button type="button" class="add_association btn btn-xs btn-primary m-auto">Add New</button>
				</div>
			</div>
		</div>
	</div>
	<div class="row mt-4 mb-2">
    <div class="col-lg-12">
      <h5 class="mb-0">Collaborating/Supervising</h5>
    </div>
	</div>
	<div class="row mb-3">
		<div class="col-lg-6">
      <label class="text-dark-grey">Name</label>
			<%= f.text_field :collab_name, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
		<div class="col-lg-6">
      <label class="text-dark-grey">NPI</label>
			<%= f.text_field :collab_npi, class: 'form-control', placeholder: 'Type here...', required: true %>
		</div>
	</div>
	<div class="row mt-3">
		<div class="col-lg-12 d-flex justify-content-end pe-5">
			<button type="submit" class="btn btn-primary btn-md"><%= is_edit_mode? ? 'Update' : 'Add' %> DCO</button>
		</div>
	</div>
<% end %>
<% content_for :js do %>
<%= HtmlUtils.form_add_required_attribute form_id: 'dco-form',
				required_fields: 'group_dco_dco_name,group_dco_dco_address,group_dco_dco_city,group_dco_state,group_dco_county,group_dco_dco_zipcode,
													group_dco_service_location_phone_number,group_dco_service_location_fax_number,group_dco_panel_status_to_new_patients,
													group_dco_panel_age_limit,group_dco_include_in_directory,group_dco_dco_provider_phone_number,group_dco_dco_provider_fax_number,
													group_dco_dco_provider_position,group_dco_inpatient_facility,group_dco_is_clinic,group_dco_telehealth_provider,group_dco_website,
													group_dco_tax_id,group_dco_facility_billing_npi,group_dco_mn_medicaid_number,group_dco_wi_medicaid_number,group_dco_medicare_id_ptan,
													group_dco_taxonomy,group_dco_telehealth_video_conferencing_technology,group_dco_is_gender_affirming_treatment,group_dco_panel_size,
													group_dco_medicare_authorized_official'
%>
<script>
	$(document).ready(function(){
			// schedules
			$("#schedules").on("click", ".add_association", function() {
				var schedulesFields = $("#schedules .field .row");
				var newSchedule = schedulesFields.last().clone();
				console.log($(newSchedule).find("input"))
				var newId = new Date().getTime();
				newSchedule.html(newSchedule.html().replace(/schedules_attributes\]\[\d+\]/g, "schedules_attributes][" + newId + "]"));
				$("#schedules .fields").append(newSchedule);

				$(newSchedule).find("select").each(function() {
					$(this).val("Day")
					$(this).find("option[selected]").first().removeAttr("selected")
				});

				$(newSchedule).find("input").each(function() {
					$(this).val("")
				});

				newSchedule.find('.remove-dynamic-fields').attr('data-id', newId);
				newSchedule.attr('data-id', newId);
				$("#schedules .fields").append(newSchedule);
			});

			$("#schedules").on("click", ".remove-dynamic-fields", function() {
				var field = document.getElementsByClassName("schedule_container");
				scheduleField = $(this).attr("data-id");

				var schedulesField = $('.schedule-fields[data-id='+scheduleField+']');
				if(field.length > 1) {
					var id = $(this).data('id');
        	var model = $(this).data('model');
					deleteDynamicAttr(id,model,$(this));
				}
			});
			// provider outreach info
			$("#dco-provider-outreach-info").on("click", ".add_association", function() {
				var providerOutreachInfoFields = $("#dco-provider-outreach-info .field .provider_outreach_info_container");
				var newProviderOutreachInfo = providerOutreachInfoFields.last().clone();
				var newId = new Date().getTime();
				newProviderOutreachInfo.html(newProviderOutreachInfo.html().replace(/provider_outreach_info_attributes\]\[\d+\]/g, "provider_outreach_info_attributes][" + newId + "]"));
				$("#dco-provider-outreach-info .fields").append(newProviderOutreachInfo);

				$(newProviderOutreachInfo).find("input").each(function() {
					$(this).val("")
				});

				newProviderOutreachInfo.find('.remove-dynamic-fields').attr('data-id', newId);
				newProviderOutreachInfo.attr('data-id', newId);
				$("#dco-provider-outreach-info .fields").append(newProviderOutreachInfo);
			});
			$("#dco-provider-outreach-info").on("click", ".remove-dynamic-fields", function() {
				var field = document.getElementsByClassName("provider_outreach_info_container");
				providerOutreachField = $(this).attr("data-id");

				var providerOutreachFields = $('.provider_outreach_info_container[data-id='+providerOutreachField+']');
				if(field.length > 1) {
					var id = $(this).data('id');
        	var model = $(this).data('model');
					deleteDynamicAttr(id,model,$(this));
				}
			});
			// group-dco-contacts
			$("#group-dco-contacts").on("click", ".add_association", function() {
				var groupDcoContactsFields = $("#group-dco-contacts .field .contact_list_container");
				var groupDcoContact = groupDcoContactsFields.last().clone();
				var newId = new Date().getTime();
				groupDcoContact.html(groupDcoContact.html().replace(/group_dco_contacts_attributes\]\[\d+\]/g, "group_dco_contacts_attributes][" + newId + "]"));
				$("#group-dco-contacts .fields").append(groupDcoContact);

				$(groupDcoContact).find("input").each(function() {
					$(this).val("")
				});

				groupDcoContact.find('.remove-dynamic-fields').attr('data-id', newId);
				groupDcoContact.attr('data-id', newId);
				$("#group-dco-contacts .fields").append(groupDcoContact);
			});

			$("#group-dco-contacts").on("click", ".remove-dynamic-fields", function() {
				var field = document.getElementsByClassName("contact_list_container");
				groupDcoContactsField = $(this).attr("data-id");
				var groupDcoContactsFields = $('.contact_list_container[data-id='+groupDcoContactsField+']');
				if(field.length > 1) {
					var id = $(this).data('id');
        	var model = $(this).data('model');
					deleteDynamicAttr(id,model,$(this));
				}
			});

      function deleteDynamicAttr(id,model,button) {
        $.ajax({
          url: '<%= delete_record_path %>',
          method: 'POST',
          data: { authenticity_token: csrfToken, id: id, model: model },
          success: function(data) {
              button.parent().parent().remove();
					}
        })
      }
	});
</script>
<% end %>