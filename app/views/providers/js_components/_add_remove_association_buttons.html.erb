<script>
  $(document).ready(function(){
          //DEA License
          $(document).ready(function () {
         $("#dea_licenses").on("click", ".add_association", function () {
          var detailsFields = $("#dea_licenses .field");
          var newEnrollmentdetails = detailsFields.last().clone();
          var lastId = detailsFields.length - 1;
          var newId = lastId + 1;
          var dea_state_id = "provider_dea_licenses_attributes_" + newId + "_state_id";
 
            newEnrollmentdetails.find("[id^='provider_dea_licenses_attributes_']").each(function() {
             var oldId = $(this).attr("id");
             var newIdValue = oldId.replace(/\d+/, newId);
             $(this).attr("id", newIdValue);
             $(this).attr("name", $(this).attr("name").replace(/\d+/, newId));
             $(this).val('');
          });
          setTimeout(function(){
 
             $.get('<%= provider_states_multi_select_data_path %>', function(data){
                VirtualSelect.init({ele: '#' + dea_state_id, search: true });
                document.querySelector('#' + dea_state_id).setOptions(data['result']);
                document.querySelector('#' + dea_state_id).setValue(value);
             });
          }, 1000);
          
            $("#dea_licenses .fields").append(newEnrollmentdetails);
          })
         });
 
         //CDS License
          $(document).ready(function () {
          $("#cds_licenses").on("click", ".add_association", function () {
          var detailsFields = $("#cds_licenses .field");
          var newEnrollmentdetails = detailsFields.last().clone();
          var lastId = detailsFields.length - 1;
          var newId = lastId + 1;
          var cds_state_id = "provider_cds_licenses_attributes_" + newId + "_state_id";
 
            newEnrollmentdetails.find("[id^='provider_cds_licenses_attributes_']").each(function() {
             var oldId = $(this).attr("id");
             var newIdValue = oldId.replace(/\d+/, newId);
             $(this).attr("id", newIdValue);
             $(this).attr("name", $(this).attr("name").replace(/\d+/, newId));
             $(this).val('');
          });
          setTimeout(function(){
 
             $.get('<%= provider_states_multi_select_data_path %>', function(data){
                VirtualSelect.init({ele: '#' + cds_state_id, search: true });
                document.querySelector('#' + cds_state_id).setOptions(data['result']);
                document.querySelector('#' + cds_state_id).setValue(value);
             });
          }, 1000);
          
           $("#cds_licenses .fields").append(newEnrollmentdetails);
          })
         });

          //RN License
          $(document).ready(function () {
         $("#rn_licenses").on("click", ".add_association", function () {
         var detailsFields = $("#rn_licenses .field");
         var newEnrollmentdetails = detailsFields.last().clone();
         var lastId = detailsFields.length - 1;
         var newId = lastId + 1;
         var rn_state_id = "provider_rn_licenses_attributes_" + newId + "_state_id";

          newEnrollmentdetails.find("[id^='provider_rn_licenses_attributes_']").each(function() {
            var oldId = $(this).attr("id");
            var newIdValue = oldId.replace(/\d+/, newId);
            $(this).attr("id", newIdValue);
            $(this).attr("name", $(this).attr("name").replace(/\d+/, newId));
            $(this).val('');
         });
            
         setTimeout(function(){

            $.get('<%= states_multi_select_data_path %>', function(data){
               VirtualSelect.init({ele: '#' + rn_state_id, search: true });
               document.querySelector('#' + rn_state_id).setOptions(data['result']);
               document.querySelector('#' + rn_state_id).setValue(value);
            });
         }, 1000);
         
          $("#rn_licenses .fields").append(newEnrollmentdetails);
         })
        });

          //APRN License
           $(document).ready(function () {
         $("#cnp_licenses").on("click", ".add_association", function () {
         var detailsFields = $("#cnp_licenses .field");
         var newEnrollmentdetails = detailsFields.last().clone();
         var lastId = detailsFields.length - 1;
         var newId = lastId + 1;
         var cnp_state_id = "provider_cnp_licenses_attributes_" + newId + "_state_id";

           newEnrollmentdetails.find("[id^='provider_cnp_licenses_attributes_']").each(function() {
            var oldId = $(this).attr("id");
            var newIdValue = oldId.replace(/\d+/, newId);
            $(this).attr("id", newIdValue);
            $(this).attr("name", $(this).attr("name").replace(/\d+/, newId));
            $(this).val('');
         });
         setTimeout(function(){

            $.get('<%= provider_states_multi_select_data_path %>', function(data){
               VirtualSelect.init({ele: '#' + cnp_state_id, search: true });
               document.querySelector('#' + cnp_state_id).setOptions(data['result']);
               document.querySelector('#' + cnp_state_id).setValue(value);
            });
         }, 1000);
         
          $("#cnp_licenses .fields").append(newEnrollmentdetails);
         })
          });

          //State License
          $(document).ready(function () {
         $("#licenses").on("click", ".add_association", function () {
         var detailsFields = $("#licenses .field");
         var newEnrollmentdetails = detailsFields.last().clone();
         var lastId = detailsFields.length - 1;
         var newId = lastId + 1;
         var state_licenses_state_id = "provider_licenses_attributes_" + newId + "_state_id";

           newEnrollmentdetails.find("[id^='provider_licenses_attributes_']").each(function() {
            var oldId = $(this).attr("id");
            var newIdValue = oldId.replace(/\d+/, newId);
            $(this).attr("id", newIdValue);
            $(this).attr("name", $(this).attr("name").replace(/\d+/, newId));
            $(this).val('');
         });

         setTimeout(function(){

            $.get('<%= provider_states_multi_select_data_path %>', function(data){
               VirtualSelect.init({ele: '#' + state_licenses_state_id, search: true });
               document.querySelector('#' + state_licenses_state_id).setOptions(data['result']);
               document.querySelector('#' + state_licenses_state_id).setValue(value);
            });
         }, 3000);
      
         
          $("#licenses .fields").append(newEnrollmentdetails);
         })
          });

          $(document).on("click", ".delete-license", function() {

              var model = $(this).data('model');
            var id = $(this).data('id');
            $(this).closest('.field').remove();
            $.ajax({
              url: '<%= delete_record_path %>',
              method: 'POST',
              data: { authenticity_token: csrfToken, model: model, id: id },
              success: function(data) {
                $(this).closest('.field').remove();

              }
            })
          });



          // telehealth providers
          $("#service_locations").on("click", ".add_association", function() {
              var serviceLocationsFields = $("#service_locations .field");
              var newServiceLocation = serviceLocationsFields.last().clone();
              var newId = new Date().getTime();
              newServiceLocation.html(newServiceLocation.html().replace(/service_locations_attributes\]\[\d+\]/g, "service_locations_attributes][" + newId + "]"));
              $("#service_locations .fields").append(newServiceLocation);

              var languageDropdown = $('[name="provider[service_locations_attributes]['+newId+'][primary_service_interpreter_language]]"]');
              languageDropdown.attr('id',("language_"+newId));
              setLanguages(languageDropdown.attr('id'));

              var statesDropdown = $('[name="provider[service_locations_attributes]['+newId+'][primary_service_telehealth_only_state]]"]');
              statesDropdown.attr('id',("states_"+newId));

              setStates(statesDropdown.attr('id'));
              var nonOfficeDropdown = $('[name="provider[service_locations_attributes]['+newId+'][primary_service_non_office_area]"]');
              nonOfficeDropdown.attr('id',("non_office_service_location_"+newId));

              setNonOfficeServiceLocation(nonOfficeDropdown.attr('id'));
              
          });

          $("#service_locations").on("click", ".remove-dynamic-fields", function() {
            var serviceLocationFields = document.getElementsByClassName("primary-service-location-field");
            if(serviceLocationFields.length > 1) {
              serviceLocationFields[0].remove();
            }
          });



      function setLanguages(dropdown_id) {
          var id = dropdown_id;
          $.ajax({
            url: '<%= get_languages_path %>',
            method: 'GET',
            data: { authenticity_token: csrfToken },
            success: function(data) {
              VirtualSelect.init({
                  options: data['languages'],
                  ele: '#'+id,
                  multiple: true,
              });
            }
          })
      }

      function setStates(dropdown_id) {
          var id = dropdown_id;
          $.ajax({
            url: '<%= get_states_path %>',
            method: 'GET',
            data: { authenticity_token: csrfToken },
            success: function(data) {
              VirtualSelect.init({
                  options: data['states'],
                  ele: '#'+id,
                  multiple: true,
              });
            }
          })
      }

      function setNonOfficeServiceLocation(dropdown_id) {
        var id = dropdown_id;
          $.ajax({
            url: '<%= get_states_with_id_path %>',
            method: 'GET',
            data: { authenticity_token: csrfToken },
            success: function(data) {
              VirtualSelect.init({
                  options: data['states'],
                  ele: '#'+id
              });
            }
          })
      }

      function setDeaStates(dropdown_id) {
        var id = dropdown_id;
          $.ajax({
            url: '<%= get_states_with_id_path %>',
            method: 'GET',
            data: { authenticity_token: csrfToken },
            success: function(data) {
              VirtualSelect.init({
                  options: data['states'],
                  ele: '#'+id
              });
            }
          })
      }
  })
</script>