
<% names = ['Lindsay Bennet', 'Bose, Paul', 'Diaz, Fynn', 'Calibre, Reese'] %>

<div class="row mt-3 mb-2 px-6">
  <div class="col-lg-6">
    <h5>Search Result: <%= @vrcs.count %> records</h5>
  </div>
  <div class="col-lg-6 d-flex justify-content-end gap-2">
    <div>
      <%= form_with url: request.url, method: :get, html: { id: 'vrc-progress-status-form' } do |form| %>
        <div style="float: right;">
          <%= form.select :'vrc-progress-status', [["All", "all"], ["Completed", "completed"], ["Assigned", "assigned"], ["To Be Assigned", "to_be_assigned"]], { selected: params[:'vrc-progress-status'] }, { style: "padding:8px; background-color: #ddd; border: 0px; border-radius: 5px; margin-left: 4px;", onchange: 'this.form.submit();' } %>
        </div>
      <% end %>
    </div>
    <div>
      <%= link_to download_clients_path(format: 'csv'), class: 'btn btn-sm btn-primary' do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px;height: 16px;">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
        </svg>
        <span>Download Documents</span>
      <% end %>
    </div>
  </div>
</div>

<div class="row mt-2">
	<div id="alert-notification" class="alert alert-danger text-white fs-4" style="background-color:#ff0000; display: none;" role="alert">
	   No provider selection is made. Please select provider(s).
  </div>
</div>
  <table class="table table-striped table-bordered table-responsive">
    <thead style="background-color: #377dff; color: #fff;">
      <tr>
        <th>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="selectAllCheckbox">
          </div>
        </th>
        <th>First Name</th>
        <th>Last Name</th>
        <th>State</th>
        <th>Review Level</th>
        <th>Status</th>
        <th>Review Date</th>
        <th>Provider Type</th>
        <th>Specialty</th>
        <th>Cred Cycle</th>
        <th>MedvId</th>
      </tr>
    </thead>
    <tbody>
<%= form_with url: '/virtual_review_committee/update_review_committee_dates', method: :put, html: { id: 'review-committee-form' } do |form| %>
      <% @vrcs.each do |vrc| %>
        	<td class="option form-check-input">
				    <% if params[:'vrc-progress-status'] == "assigned" %>
					    <%= check_box_tag "unassigned_ids[]", vrc.id, nil, id: "unassigned_#{vrc.id}" %>
					  <% else %>
					    <%= check_box_tag "assigned_ids[]", vrc.id, nil, id: "assigned_#{vrc.id}" %>
            <% end %>
          </td>
          <td><%= vrc&.first_name %></td>
          <td><%= vrc&.last_name %></td>
          <td><%= vrc&.state %></td>
          <td><%= vrc&.review_level %></td>
          <td><%= vrc&.status %></td>
          <td><%= vrc&.review_date&.strftime("%m/%d/%Y") %></td>
          <td><%= vrc&.provider_type %></td>
          <td><%= vrc&.specialty %></td>
          <td><%= vrc&.cred_cycle %></td>
          <td>
            <button id="backToTopBtn" class="btn-back-to-top"><i class="fa-solid fa-arrow-up"></i></button>
            <%= vrc&.medv_id %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <!-- Below the table -->

	<% if params[:'vrc-progress-status'] != "assigned" %>
		<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		    <div class="modal-dialog modal-dialog-centered">
		        <div class="modal-content">
		            <div class="modal-header">
		              <h5 class="modal-title fs-4" id="exampleModalLabel">Assign Reviewer(s) and Date</h5>
		              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		            </div>
		            <div class="modal-body">
		                <div id="checkbox-list">
		                	<div class="row p-0">
		                		<div class="col-lg-5 p-0">
											    <input type="checkbox" name="item" value="Director Demo Director" class="form-check-input">
											    <label class="ms-1 form-check-label" for="flexCheckDefault"> Director Demo Director</label>	
		                		</div>
		                		<div class="col-lg-6">
		                      <%= form.label :review_date, class: 'form-label' %>
		                      <%= form.date_field :review_date, class: 'form-control', required: true %>
		                		</div>
		                	</div>
						    <br>
						      <div class="row p-0">
						      	<div class="col-lg-6 p-0">
							    	  <input type="checkbox" name="item" value="Peer Demo Member" class="form-check-input">
									    <label class="ms-1 form-check-label"  for="flexCheckDefault"> Peer Demo Member</label>
						      	</div>
						      </div>
						    <br>
						    <div class="row p-0 mt-2">
		    		      <div class="col-lg-5 p-0">
								    <input type="checkbox" name="item" value="Test Demo Director" class="form-check-input">
								    <label class="ms-1 mb-2 form-check-label"  for="flexCheckDefault"> Test Demo Director</label>
		    		      </div>
				    		<div class="col-lg-6">
					    			<%= form.label :committee_date, class: 'form-label' %>
			              <%= form.date_field :committee_date, class: 'form-control', required: true %>
			              <%= form.text_field :progress_status, value: "assigned", class: 'form-control', style: 'display: none;' %>
				    		</div>
				    	</div>
						    <br>
						  </div>     
		            </div>
		              <div class="modal-footer">
		                <%= form.submit 'Update', class: 'btn btn-primary', id:"update-btn" %>
		                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
		            </div>
		        </div>
		    </div>
		</div>
	<% end %>

	<div class="col-lg-12">
	  <div class="d-flex justify-content-between bg-medium-grey rounded align-items-center py-3">
	    <div class="page_info ms-3 text-black">
	      <%= page_entries_info @vrcs %>
	    </div>
	    <% if params[:per_page].present? %>
	      <%= will_paginate @vrcs, params: { per_page: @per_page }, renderer: WillPaginate::ActionView::BootstrapLinkRenderer %>
	    <% else %>
	      <%= will_paginate @vrcs, renderer: WillPaginate::ActionView::BootstrapLinkRenderer %>
	    <% end %>
	  </div>
	</div>

  <div class="d-flex mt-4 justify-content-end">
		<button type="button" class="btn btn-primary" id="submit-button" data-bs-toggle="modal" data-bs-target="#exampleModal">
		  Assign to Committee Members
		</button>
	  <% if params[:'vrc-progress-status'] == "assigned" %>
		  <div class="mx-3">
		  	<%= form.text_field :progress_status, value: "to_be_assigned", class: 'form-control', style: 'display: none;' %>
		  	<%= form.submit 'Unassign Providers', class: 'btn btn-primary', id:"update-btn" %>
		  </div>
	  <% end %>	
  </div>
	<script>
	  document.addEventListener("DOMContentLoaded", function () {
	    const submitButton = document.getElementById("submit-button");
	    const checkboxes = document.querySelectorAll("input[name='section_ids[]']");
	    const modal = new bootstrap.Modal(document.getElementById("exampleModal"));
	    const alertMessage = document.getElementById("alert-notification");

	    submitButton.addEventListener("click", function (event) {
	      let atLeastOneCheckboxChecked = false;

	      checkboxes.forEach(function (checkbox) {
	        if (checkbox.checked) {
	          atLeastOneCheckboxChecked = true;
	        }
	      });

	      if (!atLeastOneCheckboxChecked) {
	        event.preventDefault();
	        alertMessage.style.display = "block";
	      } else {
	        modal.show();
	      }
	    });
	  });
	</script>
<% end %>

