<div class="content container-fluid">
   <div class="row">
      <div class="col-lg-12">
         <h1>Analytics</h1>
      </div>
   </div>
   <div class="row">
      <div class="col-lg-7">
         <%= render "pages/dashboard_components/clients_data"%>
         <%= render "pages/dashboard_components/providers_data"%>
         <%= render "pages/dashboard_components/server_storage"%>
         <%= render "pages/dashboard_components/traffic_chart"%>
         <div class="row">
          <%= render "pages/dashboard_components/browsers_chart"%>
         </div>
      </div>
      <div class="col-lg-5">
         <%= render "pages/dashboard_components/bar_chart"%>
         <%= render "pages/dashboard_components/doughnut_chart"%>
      </div>
   </div>
</div>

<script src="/dist/app.js" > </script>
<script >
document.addEventListener("DOMContentLoaded", function () {
   var clientData = [];
   var visitData = [];
   var browserData = [];
   var csrfToken = $('meta[name="csrf-token"]').attr('content');
   getClientDataForDoughnutGraph();
   getVisitData();
   getBrowserVisits();

   $('.provider-range-selector').on('change', function () {
      getProviderCount($(this).val());
   })

   function getProviderCount(range) {
      $.ajax({
         url: '<%= get_dashboard_providers_path %>',
         method: 'POST',
         data: {
            authenticity_token: csrfToken,
            range: range
         },
         success: function (data) {
            var providers = data['providers'];
            var order_of_providers = ["new", "assigned", "completed", "terminated", "unassigned"];
            for (var i = 0; i < providers.length; i++) {
               $('#' + order_of_providers[i] + "_providers").html(providers[i]);
            }
         }
      })
   }
  <%= render "pages/dashboard_components/doughnut_chart_js" %>
  <%= render "pages/dashboard_components/bar_chart_js" %>
  <%= render "pages/dashboard_components/traffic_chart_js" %>
  <%= render "pages/dashboard_components/browsers_chart_js" %>

});
 </script>