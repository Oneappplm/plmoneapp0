<div class="modal fade" id="addLocationModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
          <div class="modal-body">
              <div class="content">
                  <div class="modal-title">
                      <h6 class="">Add Location</h6>
                      <!-- <button class="btn btn-cancel" data-bs-dismiss="modal">Cancel</button> -->
                  </div>
                  <!-- <form action=""> -->
                      <ul class="nav nav-tabs gap-2 mt-3" id="myTab" role="tablist">
                          <li class="nav-item">
                              <a class="tab active" id="tab-general-info" data-bs-toggle="tab" href="#general-info"
                                  role="tab" aria-controls="general" aria-selected="false">
                                  General Info
                              </a>
                          </li>
                          <li class="nav-item">
                              <a class="tab" id="tab-contacts" data-bs-toggle="tab" href="#contacts"
                                  role="tab" aria-controls="contact" aria-selected="false">
                                  Contacts
                              </a>
                          </li>
                          <li class="nav-item">
                              <a class="tab" id="tab-hours" data-bs-toggle="tab" href="#hours"
                                  role="tab" aria-controls="hour" aria-selected="false">
                                  Hours
                              </a>
                          </li>
                          <li class="nav-item">
                              <a class="tab" id="tab-patient-acceptance" data-bs-toggle="tab" href="#patient-acceptance"
                                  role="tab" aria-controls="acceptance" aria-selected="false">
                                  Patient Acceptance
                              </a>
                          </li>
                          <li class="nav-item">
                              <a class="tab" id="tab-patient-access" data-bs-toggle="tab" href="#patient-access"
                                  role="tab" aria-controls="access" aria-selected="false">
                                  Patient Access
                              </a>
                          </li>
                          <li class="nav-item">
                              <a class="tab" id="tab-patient-services" data-bs-toggle="tab" href="#services"
                                  role="tab" aria-controls="service" aria-selected="false">
                                  Services
                              </a>
                          </li>
                      </ul>
                      <% url = @practice_location.persisted? ? practice_location_path(id: @practice_location.id) : practice_locations_path %>
                      <%= form_for @practice_location, url: url do |f| %>
                      <div class="tab-content mt-3" id="myTabContent1">

                      <!-- location -->
                          <div class="tab-pane fade show active" id="general-info" role="tabpanel" aria-labelledby="general-info-tab">
                          <%= render partial: "practice_locations/general_info", locals: { f: f } %>
                          </div>
                      <!-- location -->

                      <!-- contacts -->
                          <div class="tab-pane fade show" id="contacts" role="tabpanel" aria-labelledby="contacts-tab">
                          <%= render partial: 'practice_locations/contacts', locals: { f: f } %>
                          </div>
                          <!-- contacts -->

                          <div class="tab-pane fade show" id="hours" role="tabpanel" aria-labelledby="hours-tab">
                          <%= render partial: 'practice_locations/hours', locals: { f: f }%>
                          </div>

                          <div class="tab-pane fade show" id="patient-acceptance" role="tabpanel" aria-labelledby="patient-acceptance-tab">
                          <%= render partial: 'practice_locations/patient_acceptance', locals: { f: f } %>
                          </div>

                          <div class="tab-pane fade show" id="patient-access" role="tabpanel" aria-labelledby="patient-access-tab">
                          <%= render partial: 'practice_locations/patient_access', locals: { f: f } %>
                          </div>

                          <div class="tab-pane fade show" id="services" role="tabpanel" aria-labelledby="services-tab">
                              <%= render partial: 'practice_locations/services', locals: { f:f } %>
                          </div>
                      </div>
                      <div class="form-row row mt-3">
                          <%= f.submit "Save", class: 'btn btn-manage btn-primary skip-loader'%>
                      </div>
                  <% end %>

                      <div class="form-row mt-3">
                      <button type="button" class="btn btn-card-remove" data-bs-dismiss="modal">Cancel</button>
                      </div>
              </div>
          </div>
      </div>
  </div>
</div>
<script>
  $(document).ready(function () {
    function setupStatusManager(containerId, inputId, buttonId, hiddenFieldId, displayFieldId) {
      const container = $(containerId);

      if (container.length) {
        const inputField = $(inputId);
        const addButton = $(buttonId);
        const hiddenField = $(hiddenFieldId);
        const displayField = $(displayFieldId);

        if (!inputField.length || !addButton.length || !hiddenField.length || !displayField.length) {
          console.error(`⚠️ One or more elements are missing in ${containerId}!`);
          return;
        }

        let statusList = [];
        let existingValue = hiddenField.val().trim();

        if (existingValue) {
          try {
            statusList = JSON.parse(existingValue);
            if (!Array.isArray(statusList)) {
              throw new Error("Not an array");
            }
          } catch (error) {
            console.warn(`⚠️ Invalid JSON in ${hiddenFieldId}. Converting to array.`);
            statusList = existingValue.split(",").map(item => item.trim()).filter(Boolean);
          }
        }

            // Populate the display field with existing values
        displayField.val(statusList.join(", "));

        addButton.on("click", function () {
          let newStatus = inputField.val().trim();
          console.log(`✅ Adding to ${displayFieldId}:`, newStatus);

          if (newStatus !== "" && !statusList.includes(newStatus)) {
            statusList.push(newStatus);
                    inputField.val(""); // Clear input after adding

                    // Update hidden field and display field
                    hiddenField.val(JSON.stringify(statusList));
                    displayField.val(statusList.join(", "));
                  }
                });
      }
    }

    // Apply to both sections
    setupStatusManager("#tab-patient-acceptance", "#practice_status_input", "#add_to_list", "#practice_location_open_practice_status", "#practice_status_list_display");
    setupStatusManager("#tab-patient-access", "#patient_access_input", "#add_to_list_ada_wrp", "#practice_location_ada_wrp_status", "#ada_wrp_list_display");
    setupStatusManager("#tab-patient-access", "#disabled_other_services_input", "#add_to_list_disabled_other_services_wrp", "#practice_location_disabled_other_services_wrp_status", "#disabled_other_services_wrp_status_display");
    setupStatusManager("#tab-patient-access", "#public_transportation_input", "#add_to_list_public_transportation_wrp", "#practice_location_public_transportation_wrp_status", "#public_transportation_wrp_status_display");
    setupStatusManager("#tab-patient-services", "#laboratory_services_input", "#add_to_list_laboratory_services_wrp", "#practice_location_laboratory_services_wrp_status", "#laboratory_services_wrp_status_display");
    setupStatusManager("#tab-patient-services", "#radiology_services_xray_input", "#add_to_list_radiology_services_xray", "#practice_location_laboratory_services_wrp_status", "#radiology_services_xray_status_display");
    setupStatusManager("#tab-patient-services", "#anesthesia_administered_input", "#add_to_list_anesthesia_administered", "#practice_location_laboratory_services_wrp_status", "#anesthesia_administered_status_display");
  });
</script>
