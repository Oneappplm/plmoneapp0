wb = xlsx_package.workbook
s = wb.styles
header = s.add_style sz: 14, b: true, bg_color: "6EAA46", fg_color: "FFFFFF", alignment: { wrap_text: true, vertical: :center }
wb.add_worksheet(name: "Post") do |sheet|
  sheet.add_row ["Platform", "Group Name", "Provider Status", "Providers First Name", "Providers Last Name", "Pracitioner Type", "NPI",
                  "Payor", "Enrollment Type", "State", "Initial Application Status", "Date Initial Application Submitted"], style: header, height: 50
  @enrollment_details.each do |enrollment_detail|
    provider = enrollment_detail.enrollment_provider&.provider
    state_name = State.find_by(alpha_code: enrollment_detail.payer_state)&.name

    sheet.add_row [
      flatforms.detect{|flatform| flatform.last == provider&.group&.flatform }&.first,
      provider&.group&.group_name,
      provider_statuses.detect{|flatform| flatform.last == provider&.status }&.first,
      provider&.first_name,
      provider&.last_name,
      provider&.practitioner_type,
      provider.npi,
      enrollment_detail&.enrollment_payer,
      enrollment_detail.enrollment_type,
      state_name,
      application_statuses.detect{|application_status| application_status.last == enrollment_detail.enrollment_status }&.first,
      enrollment_detail.start_date&.strftime('%b %d, %Y')
    ], types: [:string, :string, :string, :string, :string]
  end
  sheet.column_widths 12, 18, 16, 24, 24, 24, 16, 16, 16, 16, 16, 16
end