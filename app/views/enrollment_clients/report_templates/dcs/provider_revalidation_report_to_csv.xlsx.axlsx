wb = xlsx_package.workbook
s = wb.styles
header = s.add_style sz: 14, b: true, bg_color: "6EAA46", fg_color: "FFFFFF", alignment: { wrap_text: true, vertical: :center }
image = File.expand_path('public/logos/dcs-logo.png')
wb.add_worksheet(name: "Post") do |sheet|
  sheet.add_image(image_src: image, start_at: 'A1', width: 300, height: 100)
  sheet.merge_cells('A1:K1')
  sheet.add_row [], height: 100
  sheet.add_row ["Group Name", "Provider Status", "First Name", "Last Name", "Practitioner Type", "NPI", "Payor", "Provider ID",
                  "Initial Effective Date", "Current Revalidation Date", "Next Revalidation Date"], style: header, height: 50
  @enrollment_details.each do |enrollment_detail|
    provider = enrollment_detail.enrollment_provider&.provider
    effective_date = Date.parse(enrollment_detail.enrollment_effective_date)&.strftime('%b %d, %Y') rescue ''
    sheet.add_row [
      provider&.group&.group_name,
      provider_statuses.detect{|provider_status| provider_status.last == provider&.status }&.first,
      provider&.first_name,
      provider&.last_name,
      provider&.practitioner_type,
      provider&.npi,
      enrollment_detail.enrollment_payer,
      enrollment_detail.provider_id,
      effective_date,
      enrollment_detail.revalidation_date&.strftime('%b %d, %Y'),
      enrollment_detail.revalidation_due_date&.strftime('%b %d, %Y')
    ], types: [:string, :string, :string, :string, :string]
  end
  sheet.column_widths 18, 16, 24, 24, 16, 16, 16, 16, 16, 16, 16
end