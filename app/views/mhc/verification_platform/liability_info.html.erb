<div class="enc-content">
	<div class="container">
	  <%= render "top_nav_buttons"%>

		<div class="row mt-4">
			<div class="col-xl-6 d-flex align-items-center">
				<div class="d-flex align-items-center gap-3">
					<h4 class="page-heading">Liabilty Record 1</h4>
					<%= link_to "Edit", mhc_verification_platform_path(page_tab: 'add_new_liability', coverage_id:  @provider_insurance_coverages.id, page_action: 'edit'), class: "btn btn-primary py-1" %>
				</div>
			</div>
		</div>
		<div class="mt-3 d-flex align-items-center justify-content-between mb-2">
			<div class="d-flex justify-content-end">
				<%= button_to mhc_provider_insurance_coverage_path(@provider_insurance_coverages.id, provider_attest_id: @provider_attest_id), method: :delete, data: { turbo_confirm: 'Are you sure?' }, class: 'btn btn-danger' do %>
					<i class="bx bx-trash"></i>
					Delete Record
				<% end %>
			</div>
		</div>
		<div class="row">
			<div class="col-xl-8 row">
				<div class="form-row row mt-3">
					<div class="col-xl-4">
						<label for="SelfIssued">Self Issued:</label>
						<span class="form-control form-control-lg">
							<%= @provider_insurance_coverages.self_insured_flag ? "Yes" : "No" %>
						</span>
					</div>
					<div class="col-xl-4">
						<label for="CoverageType">Type of Coverage:</label>
						<span class="form-control form-control-lg">
							<%= @provider_insurance_coverages.insurance_coverage_type_insurance_coverage_type_description ? "Individual" : "Shared" %>
						</span>
					</div>
					<div class="col-xl-4">
						<label for="PolicyType">Policy Type:</label>
						<span class="form-control form-control-lg">
							<%= @provider_insurance_coverages.type_of_policy ? "Occurrence" : "Claims Made" %>
						</span>
					</div>
				</div>
				<div class="page-applicable">
					<div class="card mt-3">
						<div class="form-row row p-2">
							<span class="page-note">
								<i class='bx bx-error-circle font-lightblue'></i> <span>To search for a Carrier name,
									please
									click the search button.</span>
							</span>
							<div class="form-row row mt-2">
								<div class="col-xl-6">
									<label for="CarrierName" class="">Carrier Name:</label>
									<div class="input-group gap-2">
										<span class="form-control form-control-lg">
											<%= @provider_insurance_coverages.insurance_carrier_name %>
										</span>
										<button class="btn btn-primary py-1 rounded" type="button">Search</button>
									</div>
								</div>
								<div class="col-xl-6">
									<label for="address" class=" ">Address:</label>
									<span class="form-control form-control-lg">
										<%= @provider_insurance_coverages.address.presence || "NA" %>
									</span>
								</div>
							</div>
							<div class="form-row row">
								<div class="col-xl-6">
									<label for="suitestop" class=" ">Suite/Dept/Mail Stop:</label>
									<span class="form-control form-control-lg">
										<%= @provider_insurance_coverages.address2.presence || 'NA' %>
									</span>
								</div>
								<div class="col-xl-6">
									<label for="AdditionalAddress" class=" ">Additional Address:</label>
									<span class="form-control form-control-lg">
										<%= @provider_insurance_coverages.additional_address.presence || 'NA' %>
									</span>
								</div>
							</div>
							<div class="form-row row">
								<div class="col-xl-6">
									<label for="city" class=" ">City:</label>
									<span class="form-control form-control-lg">
										<%= @provider_insurance_coverages.city.presence || 'NA' %>
									</span>
								</div>
								<div class="col-xl-6">
									<label for="county" class=" ">County:</label>
									<span class="form-control form-control-lg">
										<%= @provider_insurance_coverages.country_country_name.presence || 'NA' %>
									</span>
								</div>
							</div>
							<div class="form-row row">
								<div class="col-xl-4">
									<label for="State" class=" ">State/Province:</label>
									<span class="form-control form-control-lg">
										<%= @provider_insurance_coverages.state.presence || 'NA' %>
									</span>
								</div>
								<div class="col-xl-4">
									<label for="Zip" class=" ">Zip/Postal Code:</label>
									<span class="form-control form-control-lg">
										<%= @provider_insurance_coverages.postal_code.presence || 'NA' %>
									</span>
								</div>
								<%# <div class="col-xl-4">
									<label for="Country" class=" ">Country:</label>
									<select name="country" id="country" class="form-select ">
										<option value="">Select option</option>
									</select>
								</div> %>
							</div>
							<div class="form-row row">
								<div class="col-xl-4">
									<label for="CarrierNumber" class=" ">Carrier Phone Number:</label>
									<span class="form-control form-control-lg">
										<%= @provider_insurance_coverages.phone_number.presence || 'NA' %>
									</span>
								</div>
								<div class="col-xl-4">
									<label for="CarrierFax" class=" ">Carrier Fax Number:</label>
									<span class="form-control form-control-lg">
										<%= @provider_insurance_coverages.fax_number.presence || 'NA' %>
									</span>
								</div>
								<div class="col-xl-4">
									<label for="Country" class=" ">Email Address:</label>
									<span class="form-control form-control-lg">
										<%= @provider_insurance_coverages.email_address.presence || 'NA' %>
									</span>
								</div>
							</div>
							<div class="form-row row">
								<div class="col-xl-6">
									<label class=" " for="OriginalEffectiveDate">Original Effective
										Date:</label>
									<span class="form-control form-control-lg">
										<%= @provider_insurance_coverages.effective_date.presence || 'NA' %>
									</span>
								</div>
								<div class="col-xl-6">
									<label class=" " for="expiredate">Expiration Date:</label>
									<div class="input-group gap-3 d-flex align-items-center">
										<span class="form-control form-control-lg">
											<%= @provider_insurance_coverages.end_date.presence || 'NA' %>
										</span>
										<div class="form-check">
											<input class="form-check-input" type="checkbox" id="present-switch">
											<label class=" " class="form-check-label" for="present-switch">Does
												Not Expire</label>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="form-row row mb-2">
						<div class="col-xl-4">
							<label class=" " for="PerClaimAmount">Per Claim Amount:</label>
							<span class="form-control form-control-lg">
								<%= @provider_insurance_coverages.claim_amount.presence || 'NA' %>
							</span>
						</div>
						<div class="col-xl-4">
							<label class=" " for="AggregateAmount">Aggregate Amount:</label>
							<span class="form-control form-control-lg">
								<%= @provider_insurance_coverages.coverage_amount_aggregate.presence || 'NA' %>
							</span>
						</div>
						<div class="col-xl-4">
							<label class=" " for="UmbrellaCoverage">Umbrella Coverage (amount):</label>
							<span class="form-control form-control-lg">
								<%= @provider_insurance_coverages.umbrella_coverage_amount.presence || 'NA' %>
							</span>
						</div>
					</div>

					<div class="form-row row mb-2">
						<div class="col-xl-6">
							<div class="input-group d-flex align-items-center gap-2">
								<label for="tail_coverage" class="">Do you have tail coverage (extended reporting endorsement)?</label>
								
								<div class="form-check">
									<input 
										class="form-check-input" 
										type="radio" 
										name="provider_insurance_coverage[tail_coverage]" 
										value="true" 
										id="yesTailCoverage" 
										<%= 'checked' if @provider_insurance_coverages.tail_coverage == true %>>
									<label class="form-check-label" for="yesTailCoverage">Yes</label>
								</div>
								
								<div class="form-check">
									<input 
										class="form-check-input" 
										type="radio" 
										name="provider_insurance_coverage[tail_coverage]" 
										value="false" 
										id="noTailCoverage" 
										<%= 'checked' if @provider_insurance_coverages.tail_coverage == false %>>
									<label class="form-check-label" for="noTailCoverage">No</label>
								</div>
							</div>
						</div>
					</div>


					<div class="form-row row mb-2">
						<div class="col-xl-8">
							<div class="input-group d-flex align-items-center gap-2">
								<label for="" class=" ">Has your current carrier excluded any specific area of
									practice or procedures from your coverage?</label>
								<div class="form-check">
									<input 
										class="form-check-input" 
										type="radio" 
										name="provider_insurance_coverage[current_carrier_excluded]" 
										value="true" 
										id="yesExcludedAreaOfPractice"
										<%= 'checked' if @provider_insurance_coverages.current_carrier_excluded == true %>>
									<label class="form-check-label" for="yesExcludedAreaOfPractice">Yes</label>
								</div>
								<div class="form-check">
									<input 
										class="form-check-input" 
										type="radio" 
										name="provider_insurance_coverage[current_carrier_excluded]" 
										value="false" 
										id="noExcludedAreaOfPractice"
										<%= 'checked' if @provider_insurance_coverages.current_carrier_excluded == false %>>
									<label class="form-check-label" for="noExcludedAreaOfPractice">No</label>
								</div>
							</div>
						</div>
					</div>

					<div class="form-row row ListOfExclusions" id="exclusions-container" style="display: none;">
						<label for="ListOfExclusions" class=" ">If Yes, please list the exclusions with
							explanation:</label>
						<div class="col-xl-12">
							<span class="form-control form-control-lg">
								<%= @provider_insurance_coverages.current_carrier_excluded_explanation %>
							</span>
						</div>
					</div>

					<div class="form-row row mb-2 mt-2">
						<div class="col-xl-8">
							<div class="input-group d-flex align-items-center gap-2">
								<label for="" class=" ">Show on Tickler?</label>
								<div class="form-check">
									<input 
										class="form-check-input" 
										type="radio" 
										name="provider_insurance_coverage[show_on_tickler]" 
										value="true" 
										id="yesTickler"
										<%= 'checked' if @provider_insurance_coverages.show_on_tickler == true %>>
									<label class="form-check-label" for="yesTickler">Yes</label>
								</div>
								<div class="form-check">
									<input 
										class="form-check-input" 
										type="radio" 
										name="provider_insurance_coverage[show_on_tickler]" 
										value="false" 
										id="noTickler"
										<%= 'checked' if @provider_insurance_coverages.show_on_tickler == false %>>
									<label class="form-check-label" for="noTickler">No</label>
								</div>
							</div>
						</div>
					</div>

					<div class="form-row row mb-3">
						<label for="comment">Please list any comments:</label>
						<div class="col-xl-12">
							<span class="form-control form-control-lg">
								<%= @provider_insurance_coverages.comment.presence || 'NA' %>
							</span>
						</div>
					</div>
					<div class="form-row row justify-content-end">
						<div class="col-xl-2">
							<%= link_to 'Back', mhc_verification_platform_path(page_tab: 'liability'), class: 'btn btn-primary form-control' %>
						</div>
					</div>
				</div>
			</div>
			<div class="col-xl-4 p-2 text-center">
				<div class="row">
						<div class="col-12 m-2">
								<button class="btn btn-primary btn-sm" style="min-width: 100px; font-size: 12px" disabled>
										Verification Letter
								</button>
						</div>
						<div class="col-12 m-2">
								<button  type="button" class="btn btn-primary btn-sm" id="asdf" style="min-width: 100px; font-size: 12px" data-bs-toggle="modal" data-bs-target="#send_contact_template">
										Send Contact
								</button>
						</div>
				</div>
				<div class="card other-name-card">
					<div class="card-body">
						<h2 class="">RVA Information</h2>
						<div class="mt-3 row">
							<div class="col-12 m-2">
								<button class="btn btn-primary btn-sm" style="min-width: 100px; font-size: 12px" disabled>
									Request
								</button>
							</div>
              <p> Professional Liability Coverage </p>
							<div class="col-12 m-2">
								<button class="btn btn-primary btn-sm" style="min-width: 100px; font-size: 12px" disabled>
									Verification
								</button>
							</div>
              <div class="col-12 m-2">
								<button class="btn btn-primary btn-sm" style="min-width: 100px; font-size: 12px" disabled>
									Audit
								</button>
							</div>
							<div class="col-12 m-2">
								<button class="btn btn-primary btn-audit btn-sm" data-bs-toggle="modal" data-bs-target="#QAModal" data-information-id="<%= @last_rva_information&.id %>" data-first-name="<%= @provider_personal_information&.first_name %>" data-last-name="<%= @provider_personal_information&.last_name %>" data-personal-information-id="<%= @provider_personal_information&.id %>" data-liability-id = "<%= @provider_insurance_coverages.id%>">
											Quality Audit
								</button>
							</div>
							<div class="col-12 m-2">
                <div class="col-12 m-2">
                  <!-- Button that updates audit_status -->
                    <button class="btn btn-primary btn-sm skip-rva-btn"
                      data-information-id="<%= @last_rva_information&.id %>"
                      data-personal-information-id="<%= @provider_personal_information&.id %>"
                      data-liability-id="<%= @provider_insurance_coverages.id %>"
                      data-field-to-update="audit_status">
                      Skip RVA
                    </button>
                </div>
							</div>
              <p> Professional Liability Carrier Claims History </p>
							<div class="col-12 m-2">
								<button class="btn btn-primary btn-sm" style="min-width: 100px; font-size: 12px" disabled>
									Verification
								</button>
							</div>
              <div class="col-12 m-2">
								<button class="btn btn-primary btn-sm" style="min-width: 100px; font-size: 12px" disabled>
									Audit
								</button>
							</div>
							<div class="col-12 m-2">
								<button class="btn btn-primary btn-audit btn-sm" data-bs-toggle="modal" data-bs-target="#QAModal" data-information-id="<%= @last_rva_information&.id %>" data-first-name="<%= @provider_personal_information&.first_name %>" data-last-name="<%= @provider_personal_information&.last_name %>" data-personal-information-id="<%= @provider_personal_information&.id %>" data-claim-history-id = "<%= @provider_insurance_coverages.id%>">
											Quality Audit
								</button>
							</div>
							<div class="col-12 m-2">
                <button class="btn btn-primary btn-sm skip-rva-btn"
                  data-information-id="<%= @last_rva_information&.id %>"
                  data-personal-information-id="<%= @provider_personal_information&.id %>"
                  data-liability-id="<%= @provider_insurance_coverages.id %>"
                  data-field-to-update="claims_history_audit">
                  Skip RVA
                </button>
							</div>
              <div class="col-12 m-2">
                <button class="btn text-danger <%= @liability_rva_information_completed.present? ? '' : 'd-none' %>" data-bs-toggle="modal" data-bs-target="#QAModal" data-information-id="<%= @last_rva_information&.id %>" data-first-name="<%= @provider_personal_information&.first_name %>" data-last-name="<%= @provider_personal_information&.last_name %>" data-personal-information-id="<%= @provider_personal_information&.id %>" id="re-rva">
                  Need ReRVA
                </button>
              </div>
						</div>
						<div class="row">
							<div class="col-12 m-2">
								<button class="btn btn-primary btn-sm" style="min-width: 100px; font-size: 12px" disabled>
									View Scanned Images
								</button>
							</div>
						</div>
						<div class="card other-name-card">
							<div class="card-body">
								<h2 class="">Message Board</h2>
								<div class="mt-3 row">
									<div class="col-12 m-2">
										<button class="btn btn-primary btn-sm" style="min-width: 100px; font-size: 12px" disabled>
											Add Comment
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>


<!-- Add Comment Modal -->
<div class="modal fade" id="addCommentModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-body">
				<div class="content">
					<div class="modal-title">
						<h6 class="">Add Comment</h6>
						<button class="btn btn-cancel" data-bs-dismiss="modal">Cancel</button>
					</div>
					<form action="">
						<div class="form-row mt-3">
							<label for="">Subject:</label>
							<input type="text" class="form-control">
						</div>
						<div class="form-row">
							<label for="">Message:</label>
							<textarea name="" id="" cols="30" rows="5" class="form-control"></textarea>
						</div>
					</form>
					<div class="form-row mt-3 d-flex justify-content-center">
						<button class="btn btn-primary py-1">Post Comment</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Delete Comment Modal -->
<div class="modal fade" id="deleteCommentModal" tabindex="-1" aria-labelledby="exampleModalLabel"
	aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-body">
				<div class="content">
					<div class="modal-title">
						<h6 class="">Comment</h6>
						<button class="btn btn-cancel" data-bs-dismiss="modal">Cancel</button>
					</div>
					<form action="">
						<div class="form-row mt-3">
							<label for="">Subject:</label>
							<input type="text" class="form-control">
						</div>
						<div class="form-row">
							<label for="">Message:</label>
							<textarea name="" id="" cols="30" rows="5" class="form-control"></textarea>
						</div>
					</form>
					<div class="form-row mt-3 d-flex justify-content-center">
						<button class="btn btn-red">Delete Comment</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Quality Audit Modal -->
            <div class="modal fade" id="QAModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-lg">
                <div class="modal-content">
                  <div class="modal-body">
                    <div id="qaModalMessage" class="alert alert-info d-none"></div>
                    <div class="content">
                      <div class="modal-title">
                        <h6 class="">Quality Audit</h6>
                        <button class="btn btn-cancel" data-bs-dismiss="modal">Cancel</button>
                      </div>
                      <%= form_with model: @rva_information, url: mhc_verification_platform_generate_rva_information_path, method: :post, id: 'audit-form' do |f| %>

                        <%= hidden_field_tag :id, @last_rva_information&.id %>
                        <%= hidden_field_tag :personal_info_id %>
                        <%= hidden_field_tag :practice_liability_id %>
                        <%= hidden_field_tag :practice_claim_history_id %>
                        <%= hidden_field_tag :provider_insurance_coverages %>

                        <%= hidden_field_tag :first_name %>
                        <%= hidden_field_tag :last_name %>
                        <div class="form-row row mt-3">
                          <div class="col-xl-12">
                            <div class="card other-name-card">
                              <div class="card-header bg-secondary rounded-0">
                                <h6 class="form-heading text-white">Request</h6>
                              </div>
                              <div class="card-body">
                                <div class="d-flex justify-content-end gap-2">
                                  <button class="btn btn-primary py-1" type="button">View Request History</button>
                                  <button class="btn btn-primary py-1" type="button">View Webcrawler Image Archive</button>
                                </div>
                                <hr class="form-hr">
                                  <div class="row pt-3 pb-3">
                                  <div class="col-md-6">
                                    <button class="btn btn-sm btn-light <%= @last_rva_information.present? ? '' : 'btn-disabled' %>" 
                                            id="send-request-btn" 
                                            <%= 'disabled' if @last_rva_information.present? %>>
                                      Send Request
                                    </button>
                                  </div>
                                  <div class="col-md-6">
                                    <span class="font-bold sent-request" style="line-height: 38px;"><%= @last_rva_information&.send_request %></span>
                                  </div>
                                </div>
                                <hr class="form-hr">
                                <div class="row">
                                  <div class="col-md-6">
                                    <label for="">Requested By:</label>
                                  </div>
                                  <div class="col-md-6">
                                    <span class="font-bold requested-by"><%= @last_rva_information&.requested_by %></span>
                                  </div>
                                </div>
                                <hr class="form-hr">
                                <div class="row">
                                  <div class="col-md-6">
                                    <label for="">Requested Date:</label>
                                  </div>
                                  <div class="col-md-6">
                                    <span class="font-bold requested-date"><%= @last_rva_information&.requested_date %></span>
                                  </div>
                                </div>
                                <hr class="form-hr">
                                <div class="form-row d-flex align-items-center gap-3">
                                  <label for="">Requested Method:</label>
                                    <%= f.radio_button :requested_method, 'AutoFax', id: 'method-autofax', checked: (@last_rva_information.present? && @last_rva_information.requested_method == "AutoFax") %>
                                    <label class="form-check-label" for="method-autofax">AutoFax</label>
    
                                    <%= f.radio_button :requested_method, 'E-Mail', id: 'method-email', checked: (@last_rva_information.present? && @last_rva_information.requested_method == "E-Mail") %>
                                    <label class="form-check-label" for="method-email">E-Mail</label>
    
                                    <%= f.radio_button :requested_method, 'Letter', id: 'method-letter', checked: (@last_rva_information.present? && @last_rva_information.requested_method == "Letter") %>
                                    <label class="form-check-label" for="method-letter">Letter</label>
    
                                    <%= f.radio_button :requested_method, 'Phone', id: 'method-phone', checked: (@last_rva_information.present? && @last_rva_information.requested_method == "Phone") %>
                                    <label class="form-check-label" for="method-phone">Phone</label>
    
                                    <%= f.radio_button :requested_method, 'Website', id: 'method-website', checked: (@last_rva_information.present? && @last_rva_information.requested_method == "Website") %>
                                    <label class="form-check-label" for="method-website">Website</label>
                                  </div>
                                <span>The default contact method is letter.</span>
                                <hr class="form-hr">
                                <div class="form-row row">
                                  <div class="col-xl-6">
                                    <%= f.label :required_fee_amount, "Required Fee Amount:" %>
                                    <%= f.text_field :required_fee_amount, 
                                    class: 'form-control req-fee-amount', 
                                    placeholder: "Type here...", 
                                    value: @last_rva_information&.required_fee_amount, 
                                    disabled: true %>
                                  </div>
                                  <div class="col-xl-6">
                                    <%= f.label :check_payable_to, "Check Payable To:" %>
                                    <%= f.text_field :check_payable_to, 
                                      class: 'form-control', 
                                      placeholder: "Type here...", 
                                      value: @last_rva_information&.check_payable_to, 
                                      disabled: true %>
                                  </div>
                                </div>
                                <hr class="form-hr">
                                <div class="form-row mt-2">
                                  <%= f.check_box :include_delineation, 
                                    id: 'inc-delineation-check', 
                                    value: "Include Delineation of Privileges", 
                                    checked: @last_rva_information&.include_delineation == true %>
                                  <%= f.label :include_delineation, "Include Delineation of Privileges", for: 'inc-delineation-check' %>
                                </div>
                                <hr class="form-hr">
                                <div class="form-row d-flex align-items-center gap-3">
                                  <label for="">Check has generated?</label>
                                  <%= f.radio_button :check_generated, 'true', 
                                          id: 'check-generate-yes', 
                                          disabled: true, 
                                          checked: @last_rva_information&.check_generated == true %>
                                  <label for="check-generate-yes">Yes</label>
                                  <%= f.radio_button :check_generated, 'false', 
                                    id: 'check-generate-no', 
                                    disabled: true, 
                                    checked: @last_rva_information&.check_generated == false %>
                                  <label for="check-generate-no">No</label>
                                </div>
                                <hr class="form-hr">
                                <div class="form-row d-flex align-items-center gap-3">
                                  <label for="">Received Status:</label>
                                  <%= f.radio_button :received_status, 'Yes', 
                                        id: 'received-status-yes', 
                                        disabled: true, 
                                        checked: @last_rva_information&.received_status == 'Yes' %>
                                  <label for="received-status-yes">Yes</label>
                                  <%= f.radio_button :received_status, 'No', 
                                          id: 'received-status-no', 
                                          disabled: true, 
                                          checked: @last_rva_information&.received_status == 'No' %>
                                  <label for="received-status-no">No</label>
                                </div>
                                <hr class="form-hr">
                                <div class="row">
                                  <div class="col-md-6">
                                    <label for="">Received by:</label>
                                  </div>
                                  <div class="col-md-6">
                                     <span class="font-bold received-by">
                                       <%= @last_rva_information&.received_by.presence || ' ' %>
                                     </span>
                                  </div>
                                </div>
                                <hr class="form-hr">
                                <div class="row">
                                  <div class="col-md-6">
                                    <label for="">Received date:</label>
                                  </div>
                                  <div class="col-md-6">
                                     <span class="font-bold received-date">
                                       <%= @last_rva_information&.received_date.presence || ' ' %>
                                     </span>
                                  </div>
                                </div>
                                <hr class="form-hr">
                                <div class="form-row">
                                  <%= f.label :comments, "Comments:" %>
                                  <%= f.text_area :comments, rows: 3, class: 'form-control request-comment', value: @last_rva_information&.comments%>
                                </div>
                                <div class="form-row d-flex justify-content-end gap-2 mt-3">
                                  <button class="btn btn-primary py-1" type="button">View Received Images</button>
                                  <button class="btn btn-primary py-1" type="button" <%= 'disabled' if @last_rva_information.present? %>>Save Request</button>
                                  <button class="btn btn-primary py-1" type="button" <%= 'disabled' if !@last_rva_information.present? %>>Restart Request</button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>

                        <div class="form-row row mt-3">
                          <div class="col-xl-12">
                            <div class="card other-name-card">
                              <div class="card-header bg-secondary rounded-0">
                                <h6 class="form-heading text-white">Verification</h6>
                              </div>  
                              <div class="card-body">
                                <div class="form-row row">
                                  <div class="col-md-6">
                                    <%= f.label :source_name, 'Source Name:' %>
                                  </div>
                                  <div class="col-md-6">  
                                    <%= f.select :source_name, options_for_select([['Application', 'Application'] , ['Application Supplement', 'Application Supplement'], ['Attestation', 'Attestation'], ['Carrier', 'Carrier'] , ['Letter of Credit / Sovereign Immunity Statement', 'Letter of Credit / Sovereign Immunity Statement'], ['Malpractice Face Sheet', 'Malpractice Face Sheet'], ['NOT VERIFIED', 'NOT VERIFIED'], ['Provider Face Sheet', 'Provider Face Sheet'], ['Unable to Verify', 'Unable to Verify']], selected: @last_rva_information&.source_name.present? ? @last_rva_information&.source_name : ''), { include_blank: 'Select option' }, class: 'form-select' %>
                                  </div>
                                </div>
                                <hr>
                                <div class="form-row row">
                                  <div class="col-md-6">
                                    <%= f.label :source_date, 'Source Date:' %>
                                  </div>
                                  <div class="col-md-6">  
                                    <%= f.date_field :source_date, required: true, class: "form-control", value: @last_rva_information&.source_date %>
                                  </div>
                                </div>
                                <hr>
                                <div class="form-row row">
                                  <div class="col-md-6">
                                    <%= f.label :status, 'Status:' %>
                                  </div>
                                  <div class="col-md-6">
                                    <%= f.select :status, options_for_select([['Current', 'Current'], ['Expired', 'Expired'], ['Future Coverage', 'Future Coverage'], ['Self-insured', 'Self-insured'] , ['Unable to Verify', 'Unable to Verify'] , ['Uninsured', 'Uninsured'] , ['Verified', 'Verified'] ,['x', 'x'] , ['xx', 'xx'] ,  ['xxx', 'xxx']], @last_rva_information&.status), { include_blank: 'Select option' }, class: 'form-select' %>
                                  </div>
                                </div>
                                <hr>
                                <div class="card">
                                  <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h6 class="form-heading">Adverse Action</h6>
                                    </div>    
                                    <div class="form-row d-flex align-items-center gap-3 mt-1">
																		 <%= f.select :adverse_action, options_for_select([
																				['None', 'None'],
																				['Cancelled', 'Cancelled'],
																				['Disclosure Response Discrepancy', 'Disclosure Response Discrepancy'],
																				['Expired', 'Expired'],
																				['Expiring prior to committee', 'Expiring prior to committee'],
																				['Gap in coverage', 'Gap in coverage'],
																				['Inadequate attestation response', 'Inadequate attestation response'],
																				['Inadequate exclusions explanation', 'Inadequate exclusions explanation'],
																				['Incorrect attestation response', 'Incorrect attestation response'],
																				['Incorrect coverage amounts', 'Incorrect coverage amounts'],
																				['Insufficient Coverage', 'Insufficient Coverage'],
																				['Name not on face sheet', 'Name not on face sheet'],
																				['No record found', 'No record found'],
																				['Not Covered for Privileges Requested', 'Not Covered for Privileges Requested'],
																				['Not Renewed', 'Not Renewed'],
																				['Other', 'Other'],
																				['Reduced Limits', 'Reduced Limits'],
																				['Restricted', 'Restricted'],
																				['Special Rated', 'Special Rated'],
																				['Surcharged', 'Surcharged'],
																				['Suspended', 'Suspended'],
																				['Terminated', 'Terminated'],
																				['Unable to verify', 'Unable to verify'],
																				['Voluntary termination', 'Voluntary termination']
																			], @last_rva_information&.adverse_action), { include_blank: 'Select option' }, class: 'form-select' %>
                                    </div>
                                    <div class="form-row row">
                                      <div class="col-xl-6">
                                        <%= f.label :other_details, 'Other:' %>
                                        <%= f.text_area :other_details, rows: 5, class: 'form-control', value: @last_rva_information&.other_details  %>
                                      </div>
                                      <div class="col-xl-6">
                                        <%= f.label :adverse_action_comments, 'Comments:' %>
                                        <%= f.text_area :adverse_action_comments, rows: 5, class: 'form-control', value: @last_rva_information&.adverse_action_comments  %>
                                      </div>
                                    </div>
                                    <div class="form-row d-flex align-items-center gap-2 mt-1">
                                        <%= f.radio_button :adverse_action_status, 'Open', 
                                                          id: 'verif-open', 
                                                          checked: @last_rva_information&.adverse_action_status == 'Open' %>
                                       <%= f.label :adverse_action_status, 'Open', for: 'verif-open' %>
  
                                       <%= f.radio_button :adverse_action_status, 'Close', 
                                                          id: 'verif-close', 
                                                          checked: @last_rva_information&.adverse_action_status == 'Close' %>
                                       <%= f.label :adverse_action_status, 'Close', for: 'verif-close' %>
                                    </div>
                                    <div class="form-row d-flex align-items-center gap-2">
                                      <%= f.label :in_good_standing, 'In Good Standing?' %>
                                       <%= f.radio_button :in_good_standing, 'Yes', 
                                                          id: 'good-standing-yes', 
                                                          checked: @last_rva_information&.in_good_standing == true %>
                                       <%= f.label :in_good_standing, 'Yes', 
                                                  for: 'good-standing-yes', 
                                                  class: 'form-check-label' %>
  
                                       <%= f.radio_button :in_good_standing, 'No', 
                                                          id: 'good-standing-no', 
                                                          checked: @last_rva_information&.in_good_standing == false %>
                                       <%= f.label :in_good_standing, 'No', 
                                                  for: 'good-standing-no', 
                                                  class: 'form-check-label' %>
                                    </div>
                                  </div>
                                </div>
                                <!-- Verification Errors Section -->
                                <div class="form-row row mt-3">
                                  <div class="col-xl-12">
                                    <div class="card other-name-card">
                                      <div class="card-body">
                                        <h6 class="form-heading">Verification Errors</h6>
                                        <div class="form-row row">
                                          <div class="col-xl-6">
                                            <%= f.label :error_type, 'Error:' %>
                                            <%= f.select :error_type, options_for_select([['None', 'None'] , ['Aggregate Amount', 'Aggregate Amount'], ['Carrier email address', 'Carrier email address'], ['Carrier fax number', 'Carrier fax number'], ['Carrier Name', 'Carrier Name'], ['Carrier phone number', 'Carrier phone number'], ['Coverage for Privileges Requested', 'Coverage for Privileges Requested'], ['Expiration Date', 'Expiration Date'], ['Occurrence Amount', 'Occurrence Amount'], ['Original Effective Date', 'Original Effective Date'], ['Other', 'Other'], ['Per Claim Amount', 'Per Claim Amount'], ['Policy Holder', 'Policy Holder'], ['Policy Number', 'Policy Number'], ['Self insured', 'Self insured'], ['Tail Coverage', 'Tail Coverage'], ['Type of coverage', 'Type of coverage'], ['Umbrella Coverage', 'Umbrella Coverage']] , @last_rva_information&.error_type || 'None'), { include_blank: 'Select option' }, class: 'form-select' %>

                                          </div>
                                          <div class="col-xl-6">
                                            <%= f.label :error_comments, 'Comments:' %>
                                            <%= f.text_area :error_comments, rows: 3, class: 'form-control', value: @last_rva_information&.error_comments %>
                                          </div>
                                        </div>
                                        <div class="d-flex align-items-center justify-content-between mt-3">
                                          <button type="button" class="btn btn-primary py-1">Add Another Error</button>
                                          <button type="button" class="btn btn-danger">Remove</button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <!-- Correct Information Section -->
                                <div class="form-row row mt-3">
                                  <div class="col-xl-12">
                                    <div class="card other-name-card">
                                      <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                          <h6 class="form-heading">Correct Information</h6>
                                          <div class="d-flex gap-2">
                                            <button class="btn btn-primary py-1">Verified</button>
                                            <button class="btn btn-primary py-1">Verify and Update with Correct Information</button>
                                          </div>
                                        </div>
                                        <div class="form-row row mt-3">
                                          <div class="col-xl-6">
                                            <%= f.label :correct_info_selected, 'Select Correct Info:' %>
                                            <%= f.select :correct_info_selected, options_for_select([['Aggregate Amount', 'Aggregate Amount'] , ['Carrier email address', 'Carrier email address'], ['Carrier fax number', 'Carrier fax number'], ['Carrier Name', 'Carrier Name'], ['Carrier phone number', 'Carrier phone number'], ['Coverage for Privileges Requested', 'Coverage for Privileges Requested'], ['Expiration Date', 'Expiration Date'], ['Occurrence Amount', 'Occurrence Amount'], ['Original Effective Date', 'Original Effective Date'], ['Per Claim Amount', 'Per Claim Amount'], ['Policy Holder', 'Policy Holder'], ['Policy Number', 'Policy Number'], ['Self insured', 'Self insured'], ['Tail Coverage', 'Tail Coverage'], ['Type of coverage', 'Type of coverage'],['Umbrella Coverage', 'Umbrella Coverage']],  @last_rva_information&.correct_info_selected), { include_blank: 'Select option' }, class: 'form-select' %>
                                          </div>
                                          <div class="col-xl-6">
                                            <%= f.label :correct_info_text, 'Enter Details:' %>
                                            <%= f.text_field :correct_info_text, class: 'form-control', value: @last_rva_information&.correct_info_text %>
                                          </div>
                                        </div>
                                        <div class="d-flex align-items-center justify-content-between mt-3">
                                          <button type="button" class="btn btn-primary py-1">Add</button>
                                          <button type="button" class="btn btn-danger">Remove</button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <hr class="form-hr">
                                <div class="row mt-5">
                                  <div class="col-md-6">
                                    <label for="">Verification Status:</label>
                                  </div>
                                  <div class="col-md-6">
                                    <span class="font-bold verification-status"><%= @last_rva_information&.verification_status.presence || '' %></span>
                                  </div>
                                </div>
                                <hr class="form-hr">
                                <div class="row">
                                  <div class="col-md-6">
                                    <label for="">Notification Status:</label>
                                  </div>
                                  <div class="col-md-6">
                                    <span class="font-bold notification-status"><%= @last_rva_information&.notification_status.presence || '' %></span>
                                  </div>
                                </div>
                                <hr class="form-hr">
                                <div class="row">
                                  <div class="col-md-6">
                                    <label for="">Verification Date:</label>
                                  </div>
                                  <div class="col-md-6">
                                    <span class="font-bold verification-date"><%= @last_rva_information&.verification_date.presence || '' %></span>
                                  </div>
                                </div>
                                <hr class="form-hr">
                                <div class="row">
                                  <div class="col-md-6">
                                    <label for="">Verifier:</label>
                                  </div>
                                  <div class="col-md-6">
                                    <span class="font-bold verifier"><%= @last_rva_information&.verifier.presence || '' %></span>
                                  </div>
                                </div>
                                <hr class="form-hr">

                                <!-- Comments and Save Button -->
                                <div class="form-row row mt-3">
                                  <div class="col-xl-12">
                                    <%= f.label :verification_comments, 'Comments:' %>
                                    <%= f.text_area :verification_comments, rows: 3, class: 'form-control', value: @last_rva_information&.verification_comments %>
                                  </div>
                                </div>
                                <div class="d-flex justify-content-end gap-2 mt-3">
                                  <%= f.button 'Save Verification', class: 'btn btn-primary py-1', id: 'verification-btn' %>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="form-row row mt-3">
                          <div class="card other-name-card">
                            <div class="card-body">
                              <h6 class="form-heading">Audit</h6>

                              <div class="form-row row mt-3">
                                <div class="col-xl-12">
                                  <div class="card other-name-card">
                                    <div class="card-body">
                                      <h6 class="form-heading">Reasons</h6>
                                      <div class="form-row row">
                                        <div class="col-xl-6">
                                          <%= f.label :audit_reason, 'Reason:' %>
																					<%= f.select :audit_reason, options_for_select([ ['None', 'None'] , ['Adverse Action Not Recorded', 'Adverse Action Not Recorded'] , ['DEA Registration Number Incorrect', 'DEA Registration Number Incorrect'] , ['Expiration Date Incorrect', 'Expiration Date Incorrect'] , ['Expires Before 30 Days', 'Expires Before 30 Days'] ,['Issue Date Incorrect', 'Issue Date Incorrect'], ['Limited or Restricted Status Incorrect', 'Limited or Restricted Status Incorrect'], ['Schedule Incorrect', 'Schedule Incorrect'], ['Show on Tickler Status Incorrect', 'Show on Tickler Status Incorrect'], ['Source Date Greater Than 90 Days', 'Source Date Greater Than 90 Days'], ['Source Date Incorrect', 'Source Date Incorrect'], ['Source Name Incorrect', 'Source Name Incorrect'], ['Theorem: Incorrect Information Entered', 'Theorem: Incorrect Information Entered'], ['Theorem: Necessary Information Not Entered', 'Theorem: Necessary Information Not Entered'], ['Theorem: Unnecessary Information Entered', 'Theorem: Unnecessary Information Entered'], ['Verification Not Uploaded', 'Verification Not Uploaded'], ['Verification Status Incorrect', 'Verification Status Incorrect']], @last_rva_information&.audit_reason), { include_blank: 'Select option' }, class: 'form-select' %>   
                                        </div>
                                        <div class="col-xl-6">
                                          <%= f.label :audit_reason_comments, 'Comments:' %>
                                          <%= f.text_field :audit_reason_comments, class: 'form-control', value: @last_rva_information&.audit_reason_comments %>
                                        </div>
                                      </div>
                                      <div class="d-flex align-items-center justify-content-between mt-3">
                                        <%= button_tag 'Add Another Reason', class: 'btn btn-primary py-1', type: 'button' %>
                                        <%= button_tag 'Remove', class: 'btn btn-danger', type: 'button' %>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              <div class="form-row d-flex align-items-center gap-3">
                                <%= f.label :audit_status, 'Audit Status:' %>
                                  <%= f.radio_button :audit_status, 'Pass', 
                                                      id: 'audit-status-pass', 
                                                      class: 'form-check-input', 
                                                      required: true, 
                                                      checked: @last_rva_information&.audit_status == true %>
                                  <%= f.label :audit_status, 'Pass', 
                                               for: 'audit-status-pass', 
                                               class: 'form-check-label' %>
  
                                  <%= f.radio_button :audit_status, 'Fail', 
                                                      id: 'audit-status-fail', 
                                                      class: 'form-check-input', 
                                                      required: true, 
                                                      checked: @last_rva_information&.audit_status == false %>
                                  <%= f.label :audit_status, 'Fail', 
                                               for: 'audit-status-fail', 
                                               class: 'form-check-label' %>
                              </div>
                              <hr class="form-hr">

                              <div class="row">
                                <div class="col-md-6">
                                  <label for="">Audit Date:</label>
                                </div>
                                <div class="col-md-6">
                                  <span class="font-bold" id="rva_information_audit_date"><%= @last_rva_information&.audit_date.presence || '' %></span>
                                </div>
                              </div>
                              <hr class="form-hr">

                              <div class="row">
                                <div class="col-md-6">
                                  <label for="">Auditor:</label>
                                </div>
                                <div class="col-md-6">
                                  <span class="font-bold" id="rva_information_auditor"><%= @last_rva_information&.auditor.presence || '' %></span>
                                </div>
                              </div>
                              <hr class="form-hr">

                              <div class="form-row row">
                                <div class="col-xl-12">
                                  <%= f.label :audit_comments, 'Comments:' %>
                                  <%= f.text_area :audit_comments, rows: 3, class: 'form-control', value: @last_rva_information&.audit_comments %>
                                </div>
                              </div>

                              <div class="d-flex justify-content-end gap-2 mt-3">
                                <%= f.button 'Save Audit', class: 'btn btn-primary py-1', id: 'audit-btn' %>
                              </div>
                            </div>
                          </div>
                        </div>
                      <% end %>  
                    </div>
                  </div>
                </div>
              </div>
            </div>

<!-- Verification Letter Modal -->
<div class="modal fade" id="verifLetterModal" tabindex="-1" aria-labelledby="exampleModalLabel"
	aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-body">
				<div class="content">
					<div class="modal-title">
						<h6 class="offset-md-3">Liability Verification Letter</h6>
						<button class="btn btn-cancel" data-bs-dismiss="modal">Cancel</button>
					</div>
					<div class="mt-3 left-pane">
						<h6>Preview Letter</h6>
					</div>
					<div class="form-row row page-applicable mt-3">
						<div class="col-xl-12">
							<div class="card other-name-card">
								<div class="card-body">
									<h6 class="form-heading">Send Fax</h6>
									<span class="page-note mt-1">
										<i class='bx bx-error-circle font-red'></i> <span>Please correct the invalid fax number. Fields will be enabled once corrected.</span>
									</span>
									<div class="form-row mt-2">
										<label for="">Fax2Mail Email Address:</label>
										<input type="text" id="fax-email" name="fax-email" class="form-control" placeholder="Type here...">
									</div>
									<div class="form-row d-flex justify-content-end mt-4">
										<button class="btn btn-primary py-1">
											Send Fax
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="form-row row page-applicable mt-3">
						<div class="col-xl-12">
							<div class="card other-name-card">
								<div class="card-body">
									<h6 class="form-heading">Send Email</h6>
									<span class="page-note mt-1">
										<i class='bx bx-error-circle font-red'></i> <span>Please correct the invalid email address. Fields will be enabled once corrected.</span>
									</span>
									<div class="form-row mt-2">
										<label for="">Email Address To:</label>
										<input type="text" id="email-to" name="email-to" class="form-control" placeholder="Type here...">
									</div>
									<div class="form-row">
										<label for="">Email Address CC:</label>
										<input type="text" id="email-cc" name="email-cc" class="form-control" placeholder="Type here...">
									</div>
									<div class="form-row d-flex justify-content-end mt-4">
										<button class="btn btn-primary py-1">
											Send Email
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="form-row mt-3 d-flex justify-content-center">
						<button class="btn btn-red">Delete Comment</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const yesRadio = document.getElementById("yesExcludedAreaOfPractice");
    const noRadio = document.getElementById("noExcludedAreaOfPractice");
    const exclusionContainer = document.getElementById("exclusions-container");

    function toggleExclusions() {
      if (yesRadio.checked) {
        exclusionContainer.style.display = "block";
      } else {
        exclusionContainer.style.display = "none";
      }
    }

    // Attach event listeners
    yesRadio.addEventListener("change", toggleExclusions);
    noRadio.addEventListener("change", toggleExclusions);

    // Initial setup
    toggleExclusions();
  });

    $(document).ready(function() {
      
        // send request parameter
        $('#send-request-btn').click(function (e) {
          e.preventDefault();
          var firstName = $('#firstname').html().trim();
          var personalInfoId = $('input[name="personal_info_id"]').val();
          var PracticeLiabilityId = $('input[name="practice_claim_history_id"]').val();
          $('.loading-overlay').show();

          $.ajax({
            url: '/webscrapers/send_liability_request',
            method: 'POST',
            headers: {
              'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content'),
            },
            data: {
              first_name: firstName,
              personal_info_id: personalInfoId,
              liability_id: PracticeLiabilityId
            },
            success: function (response) {
              // set the values
              const data =  response.rva_information;
              document.querySelector('[name="id"]').value = data.id;
              $('#send-request-btn').attr('disabled', 'true');
              $('#send-request-btn')[0].classList.remove('btn');
              $('.sent-request')[0].innerHTML = data.send_request;
              $('.requested-by')[0].innerHTML = data.requested_by;
              $('.requested-date')[0].innerHTML = data.requested_date;
              $(`#method-${data.requested_method}`).checked = true;
              $('.req-fee-amount')[0].value = data.required_fee_amount;
              $('input[name="check_generated"]').checked = data.required_fee_amount;
              $('.received-by')[0].innerHTML = data.received_by;
              $('.received-date')[0].innerHTML = data.received_date;
              $('input[name="received_status"]').checked = data.received_status;
              $('.request-comment')[0].value = data.comments;
              $('.loading-overlay').hide();
            },
            error: function () {
            },
          });
        });

        $('#verification-btn').click(function(e) {
          e.preventDefault(); // Prevent default form submission
            // Check if source_date is filled
            if (!$('#rva_information_source_date').val()) {
              alert("Please select a Source Date before saving.");
              return;
            }

          // Serialize the form data from #audit-form
          const auditFormData = $('#audit-form').serialize();
          const additionalParams = 'section=audit'; 


          // Combine the form data and additional data into a single object
          $.ajax({
            url: '/mhc/verification-platform/generate_rva_information',
            method: 'POST',
            headers: {
              'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content'),
            },
            data: `${auditFormData}&section=verification`, // Combine serialized data
            success: function(response) {
              // Handle success (e.g., display a success message)
              const data = response.rva_information;
              $('input[name="rva_information[audit_status]"]').removeAttr('disabled')
              $('#rva_information_source_name').attr('disabled', true);
              $('#rva_information_source_date').attr('disabled', true);
              $('#rva_information_status').attr('disabled', true);
              $('#rva_information_other_details').attr('disabled', true);
              $('.verification-status')[0].innerHTML = data.verification_status;
              $('.verification-date')[0].innerHTML = data.verification_date;
              $('.verifier')[0].innerHTML = data.verifier;
              $('#rva_information_verification_comments')[0].value = data.verification_comments;
              $(`#verif-${data.adverse_action_status}`).checked = data.adverse_action_status;
              $('input[name="rva_information[in_good_standing]"]').checked = data.in_good_standing;
            },
            error: function(xhr, status, error) {
              console.error('Error:', error);
            }
          });
        });
        $('#audit-btn').click(function(e) {
          e.preventDefault(); // Prevent default form submission
           // Check if an audit status is selected
            if (!$('input[name="rva_information[audit_status]"]:checked').val()) {
              alert("Please select an Audit Status before saving.");
              return;
            }

          // Serialize the form data from #audit-form
          const auditFormData = $('#audit-form').serialize();
          var practiceInfoEducationId = $('input[name="practice_liability_id"]').val();
          var practiceEducationId = $('input[name="practice_claim_history_id"]').val();

          // Combine the form data and additional data into a single object
          $.ajax({
            url: '/mhc/verification-platform/generate_rva_information',
            method: 'POST',
            headers: {
              'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content'),
            },
            data: `${auditFormData}&section=audit&practice_liability_id=${practiceInfoEducationId}&practice_claim_history_id=${practiceEducationId}`, // Combine serialized data
            success: function(response) {
              const data = response.rva_information;
              $('input[name="rva_information[audit_status]"]').value = data.audit_status;
              $('#rva_information_audit_date')[0].innerHTML = data.audit_date;
              $('#rva_information_auditor')[0].innerHTML = data.auditor;
              $('#rva_information_audit_comments')[0].value = data.audit_comments;
              $('#re-rva')[0].classList.remove('d-none');
            },
            error: function(xhr, status, error) {
              console.error('Error:', error);
            }
          });
        });
      });

    var csrfToken = $('meta[name="csrf-token"]').attr('content');

    $("#ajaxForm").submit(function(e){
        e.preventDefault();
        var action = $(this).attr("action");
        var formData = new FormData(this)
        formData.append('authenticity_token', csrfToken);
        $.ajax({
            type: "POST",
            url: action,
            crossDomain: true,
            data: formData,
            dataType: "json",
            contentType: "multipart/form-data",
            processData: false,
            contentType: false,
            headers: {
                "Accept": "application/json"
            }
        }).done(function() {
            $('#btn-modal-close').trigger('click');
            $('.loading-overlay').hide();
        }).fail(function() {
            alert('An error occurred.')
            $('.loading-overlay').hide();
        });
    });

     // Skip RVA Button Click
      document.addEventListener('DOMContentLoaded', function () {
        const skipButtons = document.querySelectorAll('.skip-rva-btn');

        skipButtons.forEach(button => {
          if (!button.dataset.listenerAttached) {
            button.dataset.listenerAttached = 'true';

            button.addEventListener('click', function (e) {
              e.preventDefault();

              const informationId = button.dataset.informationId;
              const personalInformationId = button.dataset.personalInformationId;
              const liabilityId = button.dataset.liabilityId || button.dataset.claimHistoryId;

              document.querySelector('.loading-overlay').style.display = 'block';
              const fieldToUpdate = button.dataset.fieldToUpdate || 'audit_status'; // default fallback

                fetch('/webscrapers/send_liability_skip_rva', {
                  method: 'POST',
                  headers: {
                    'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content,
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({
                    information_id: informationId,
                    personal_information_id: personalInformationId,
                    liability_id: liabilityId,
                    field_to_update: fieldToUpdate
                  }),
                })


              .then(response => response.json())
              .then(data => {
                document.querySelector('.loading-overlay').style.display = 'none';
                if (data.success) {
                  populateRvaData(data.rva_information);
                  const modal = new bootstrap.Modal(document.getElementById('QAModal'));
                  modal.show();
                } else {
                  alert('Failed to create RVA record');
                }
              })
              .catch(error => {
                console.error('Error:', error);
                document.querySelector('.loading-overlay').style.display = 'none';
              });
            });
          }
        });
      });

  document.addEventListener('DOMContentLoaded', function() {
    const qualityAuditModal = document.getElementById('QAModal');
    qualityAuditModal.addEventListener('show.bs.modal', function (event) {
      const button = event.relatedTarget; 
      const FirstName = button.getAttribute('data-first-name');
      const LastName = button.getAttribute('data-last-name');
      const InformationId = button.getAttribute('data-information-id');
      const personalInfoId = button.getAttribute('data-personal-information-id');
      const practiceInfoEducationId = button.getAttribute('data-liability-id');
      const practiceEducationId = button.getAttribute('data-claim-history-id');

      // Update the hidden field in the form with the document ID
      document.querySelector('[name="practice_liability_id"]').value = practiceInfoEducationId;
      document.querySelector('[name="practice_claim_history_id"]').value = practiceEducationId;

       document.querySelector('[name="first_name"]').value = button.dataset.firstName || '';
       document.querySelector('[name="last_name"]').value = button.dataset.lastName || '';
       document.querySelector('[name="id"]').value = button.dataset.informationId || '';
       document.querySelector('[name="personal_info_id"]').value = button.dataset.personalInformationId || '';
       document.querySelector('[name="provider_insurance_coverages"]').value = button.dataset.liabilityId || '';
       document.querySelector('[name="provider_insurance_coverages"]').value = button.dataset.liabilityId || '';
    });
  });
   function populateRvaData(rvaInfo) {
      if (!rvaInfo) return;
  
      const setElementValue = (selector, value) => {
        const element = document.querySelector(selector);
        if (element) element.value = value || '';
      };
  
      const setElementText = (selector, value) => {
        const element = document.querySelector(selector);
        if (element) element.innerText = value || '';
      };
  
      const setElementChecked = (selector, value) => {
        const element = document.querySelector(selector);
        if (element) element.checked = !!value;
      };
  
      // Populate General Data
      setElementValue('[name="id"]', rvaInfo.id);
      setElementText('.sent-request', rvaInfo.send_request);
      setElementText('.requested-by', rvaInfo.requested_by);
      setElementText('.requested-date', rvaInfo.requested_date);
      setElementValue('.req-fee-amount', rvaInfo.required_fee_amount);
      setElementText('.received-by', rvaInfo.received_by);
      setElementText('.received-date', rvaInfo.received_date);
      setElementValue('.request-comment', rvaInfo.comments);
      setElementChecked('input[name="check_generated"]', rvaInfo.required_fee_amount);
      setElementChecked('input[name="received_status"]', rvaInfo.received_status);
  
      // Check requested method dynamically
      if (rvaInfo.requested_method) {
        const methodElement = document.getElementById(`method-${rvaInfo.requested_method}`);
        if (methodElement) methodElement.checked = true;
      }
  
      // Verification Section
      setElementText('.verification-status', rvaInfo.verification_status);
      setElementText('.verification-date', rvaInfo.verification_date);
      setElementText('.verifier', rvaInfo.verifier);
      setElementValue('#rva_information_verification_comments', rvaInfo.verification_comments);
      setElementChecked('input[name="rva_information[in_good_standing]"]', rvaInfo.in_good_standing);
  
      // Audit Section
      setElementValue('input[name="rva_information[audit_status]"]', rvaInfo.audit_status);
      setElementText('#rva_information_audit_date', rvaInfo.audit_date);
      setElementText('#rva_information_auditor', rvaInfo.auditor);
      setElementValue('#rva_information_audit_comments', rvaInfo.audit_comments);
  
      // Check audit status dynamically
      if (rvaInfo.audit_status === true) {
        const auditPass = document.getElementById('audit-status-pass');
        if (auditPass) auditPass.checked = true;
      } else {
        const auditFail = document.getElementById('audit-status-fail');
        if (auditFail) auditFail.checked = true;
      }
  
      // Handle adverse action dynamically
      if (rvaInfo.adverse_action_status !== undefined) {
        const adverseActionElement = document.getElementById(`verif-${rvaInfo.adverse_action_status}`);
        if (adverseActionElement) adverseActionElement.checked = true;
      }
   }
</script>