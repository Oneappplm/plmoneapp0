<%= form_for(@provider_education, url: mhc_provider_education_path(id: @provider_education.id, page_tab: 'education')) do |f| %>
    <%= f.hidden_field :caqh_provider_attest_id %>
    <%= f.hidden_field :provider_attest_id %>
    <div class="enc-content">
        <div class="container">
            <%= render "top_nav_buttons"%>
            <div class="mt-4">
                <div class="d-flex align-items-center gap-3">
                    <a href="<%= mhc_verification_platform_path(page_tab: 'education')%>" class="link-back">
                        <i class='bx bx-left-arrow-alt'></i>
                    </a>
                    <h4 class="page-heading">Education Record</h4>
                </div>
            </div>
            <div class="row">
                <div class="col-xl-8 row">
                    <div class="col-12">
                        <label class="text-dark-grey">Institution Name:</label>
                        <%= f.text_field :institution_name,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-12">
                        <label class="text-dark-grey">Address:</label>
                        <%= f.text_field :address,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-12">
                        <label class="text-dark-grey">Other Address:</label>
                        <%= f.text_field :address2,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">City:</label>
                        <%= f.text_field :city,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Province:</label>
                        <%= f.text_field :province,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">State:</label>
                        <%= f.text_field :state,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Postal Code:</label>
                        <%= f.text_field :postal_code,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Start Date:</label>
                        <%= f.date_field :start_date, placeholder: 'Select a date...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">End Date:</label>
                        <%= f.date_field :end_date, placeholder: 'Select a date...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-12">
                        <label class="text-dark-grey">Affiliated University Name:</label>
                        <%= f.text_field :affiliated_university_name,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-12">
                        <label class="text-dark-grey">Hospital Department Name:</label>
                        <%= f.text_field :hospital_department_name, placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-12">
                        <label class="text-dark-grey">Training Area:</label>
                        <%= f.text_field :training_area,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Email Address:</label>
                        <%= f.text_field :email_address,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Certificate Issued By:</label>
                        <%= f.text_field :certificate_issued_by, placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="checkboxes" style="display: flex; gap: 10px; margin-top: 20px;">
                        <div>
                            <%= f.label :apa_approved_flag, "Apa Approved Flag" %>
                            <%= f.check_box :apa_approved_flag %>
                        </div>
                        <div>
                            <%= f.label :program_completed_flag, "Program Completed Flag" %>
                            <%= f.check_box :program_completed_flag %>
                        </div>

                        <div>
                            <%= f.label :disciplinary_action_flag, "Disciplinary Action flag " %>
                            <%= f.check_box :disciplinary_action_flag %>
                        </div>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Program Title</label>
                        <%= f.text_field :program_title,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Program Director:</label>
                        <%= f.text_field :program_director,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Completion Date:</label>
                        <%= f.date_field :completion_date, placeholder: 'Select a date...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Certificate Awarded:</label>
                        <%= f.text_field :certificate_awarded,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Teaching Position:</label>
                        <%= f.text_field :teaching_position,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Current Program Director:</label>
                        <%= f.text_field :current_program_director,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Incomplete Explanation:</label>
                        <%= f.text_field :incomplete_explanation,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Phone Number:</label>
                        <%= f.text_field :phone_number,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                        <div class="col-xl-6">
                        <label class="text-dark-grey">Fax Number:</label>
                        <%= f.text_field :fax_number,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Disciplinary Action Explanation:</label>
                        <%= f.text_field :disciplinary_action_explanation,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                        <div class="col-xl-6">
                        <label class="text-dark-grey">Program Director Degree:</label>
                        <%= f.text_field :program_director_degree,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Program Type:</label>
                        <%= f.text_field :program_type,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Additional Training Description:</label>
                        <%= f.text_field :additional_training_description,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Education Type Name:</label>
                        <%= f.text_field :education_type_name,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Hours:</label>
                        <%= f.text_field :hours,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Country Country Name:</label>
                        <%= f.text_field :country_country_name,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Degree Degree Abbreviation:</label>
                        <%= f.text_field :degree_degree_abbreviation,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Specialty Specialty Name:</label>
                        <%= f.text_field :specialty_specialty_name,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-xl-6">
                        <label class="text-dark-grey">Institution Type Institution Type Description:</label>
                        <%= f.text_field :institution_type_institution_type_description,  placeholder: 'Type here...', class: 'form-control border border-dark' %>
                    </div>
                    <div class="col-12 text-left" style="margin-top: 20px;">
                        <%= f.submit 'Save', class: 'btn btn-primary', style: 'width: 200px;' %>
                    </div>
                </div>
                <% if @provider_education.persisted? %>
                    <div class="col-xl-4 p-2 text-center">
                        <div class="row">
                            <div class="col-12 m-2">
                                <button class="btn btn-primary btn-sm" style="min-width: 100px; font-size: 12px" disabled>
                                    Verification Letter
                                </button>
                            </div>
                            <div class="col-12 m-2">
                                <button  type="button" class="btn btn-primary btn-sm" id="asdf" style="min-width: 100px; font-size: 12px" data-bs-toggle="modal" data-bs-target="#send_contact_template">
                                    Send Contact
                                </button>
                            </div>
                        </div>
                        <div class="card other-name-card">
                            <div class="card-body">
                                <h2 class="">RVA Information</h2>
                                <div class="mt-3 row">
                                    <div class="col-12 m-2">
                                        <button class="btn btn-primary btn-sm" style="min-width: 100px; font-size: 12px" disabled>
                                            Request
                                        </button>
                                    </div>
                                    <div class="col-12 m-2">
                                        <button class="btn btn-primary btn-sm" style="min-width: 100px; font-size: 12px" disabled>
                                            Verification
                                        </button>
                                    </div>
                                    <div class="col-12 m-2">
                                        <button class="btn btn-primary btn-sm" style="min-width: 100px; font-size: 12px" disabled>
                                            Audit
                                        </button>
                                    </div>
                                    <div class="col-12 m-2">
                                        <button class="btn btn-primary btn-sm" style="min-width: 100px; font-size: 12px" disabled>
                                            Quality Audit
                                        </button>
                                    </div>
                                    <div class="col-12 m-2">
                                        <button class="btn btn-primary btn-sm" style="min-width: 100px; font-size: 12px" disabled>
                                            Skip RVA
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <% end %>
            </div>
        </div>
        
    </div>
<% end %>

<div class="modal fade" id="send_contact_template" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="p-4">
                <h2 class="text-center">Send Contact</h3>
                <div class="card other-name-card">
                    <div class="card-body">
                        <div class="col-xl-12 py-2">
                            <form accept-charset="UTF-8" action=<%= mhc_verification_platform_send_contact_path %> method="POST" enctype="multipart/form-data" target="_blank" id="ajaxForm">
                            <%# <form id='send_contact_form'> %>
                                <div class="row p-2">
                                    <div class="col-2 m-auto">
                                        Practitioner Name:
                                    </div>
                                    <div class="col-10">
                                        <input type="text" name="practitioner_name" value="<%= @provider_personal_information.fullname %>" class="form-control border-none" style="border: none!important" placeholder="Type here..." disabled>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-2 m-auto">
                                        Select Contact To:
                                    </div>
                                    <div class="col-10">
                                        <select id="provider_type" name="provider_type" class="form-select">
                                            <option value="credentialing_contact" selected>Credentialing Contact</option>
                                            <option value="confidential_contact">Confidential Contact</option>
                                            <option value="client_contact">Client Contact</option>
                                            <% if @provider_education.persisted? %>
                                                <option value="intitution_contact"><%= @provider_education.institution_name%></option>
                                            <% end %>
                                        </select>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-2 m-auto">
                                        Contact Method:
                                    </div>
                                    <div class="col-10 row">
                                        <div class="col-4 form-check d-flex align-items-center gap-2">
                                            <input class="form-check-input contact_method_radio" type="radio" name="contact_method_radio" id="contact-method-email" value="email" checked>
                                            <label class="form-check-label" for="contact-method-email">
                                                Email
                                            </label>
                                        </div>
                                        <div class="col-4 form-check d-flex align-items-center gap-2">
                                            <input class="form-check-input contact_method_radio" type="radio" name="contact_method_radio" id="contact-method-fax" value="fax" disabled>
                                            <label class="form-check-label" for="contact-method-fax">
                                                Fax
                                            </label>
                                        </div>
                                        <div class="col-4 form-check d-flex align-items-center gap-2">
                                            <input class="form-check-input contact_method_radio" type="radio" name="contact_method_radio" id="contact-method-letter" value="letter" disabled>
                                            <label class="form-check-label" for="contact-method-letter">
                                                Letter
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-2 m-auto">
                                        To:
                                    </div>
                                    <div class="col-10">
                                        <input type="text" id="to" name="to" class="form-control" placeholder="Type here..." required="true" value=<%= @provider_personal_information.provider_personal_information_credentialing_contact&.email%>>
                                    </div>
                                    <input type="hidden" id="cred_contact_email" value=<%= @provider_personal_information.provider_personal_information_credentialing_contact&.email %>>
                                    <input type="hidden" id="conf_contact_email" value=<%= @provider_personal_information.provider_personal_information_confidential_contact&.email %>>
                                    <input type="hidden" id="client_contact_email" value="">
                                    <input type="hidden" id="intitution_contact_email" value=<%= @provider_education.email_address %>>

                                </div>
                                <div class="row p-2">
                                    <div class="col-2 m-auto">
                                        Subject:
                                    </div>
                                    <div class="col-10">
                                        <input type="text" name="subject" class="form-control" placeholder="Type here..." required="true">
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-2 m-auto">
                                        Attachments:
                                    </div>
                                    <div class="col-10">
                                        <input type="file" name="attachments[]" multiple="multiple" class="form-control" placeholder="Type here..." required="true">
                                    </div>
                                </div>
                                <textarea class="form-control" name="message" placeholder="Type here..." rows="8" required="true"></textarea>
                            </form>
                        </div>
                </div>
                <button type="submit" class="btn btn-primary btn-md w-100" form="ajaxForm">
                    <strong>Send</strong>
                </button>
                <button class="btn btn-cancel w-100" data-bs-dismiss="modal" id="btn-modal-close">Cancel</button>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    $(document).ready(function() {
        $('.contact_method_radio').on('change',function(e) {
            if($(this).val() == 'email') {
                var provider_type = $('#provider_type').val()
                console.log("provider_type")
                if(provider_type == 'credentialing_contact') {
                    $('#to').val($('#cred_contact_email').val())
                }
                if(provider_type == 'confidential_contact') {
                    $('#to').val($('#conf_contact_email').val())
                }
                if(provider_type == 'client_contact') {
                    $('#to').val($('#client_contact_email').val())
                }
                if(provider_type == 'intitution_contact') {
                    $('#to').val($('#intitution_contact_email').val())
                }
            }
        });

        $('#provider_type').on('change',function(e) {
            if($(this).val() == 'credentialing_contact') {
                $('#to').val($('#cred_contact_email').val())
            }
            if($(this).val() == 'confidential_contact') {
                $('#to').val($('#conf_contact_email').val())
            }
            if($(this).val() == 'client_contact') {
                $('#to').val($('#client_contact_email').val())
            }
            if($(this).val() == 'intitution_contact') {
                $('#to').val($('#intitution_contact_email').val())
            }
        });
    })

    var csrfToken = $('meta[name="csrf-token"]').attr('content');

    $("#ajaxForm").submit(function(e){
        e.preventDefault();
        var action = $(this).attr("action");
        var formData = new FormData(this)
        formData.append('authenticity_token', csrfToken);
        $.ajax({
            type: "POST",
            url: action,
            crossDomain: true,
            data: formData,
            dataType: "json",
            contentType: "multipart/form-data",
            processData: false,
            contentType: false,
            headers: {
                "Accept": "application/json"
            }
        }).done(function() {
            $('#btn-modal-close').trigger('click');
            $('.loading-overlay').hide();
        }).fail(function() {
            alert('An error occurred.')
            $('.loading-overlay').hide();
        });
    });
</script>